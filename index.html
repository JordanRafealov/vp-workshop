<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Value Proposition Workshop</title>
<script>
// Load theme BEFORE paint to prevent flash
(function(){var t=localStorage.getItem('vpTheme');if(t==='light')document.documentElement.classList.add('light');})();
</script>
<style>
/* ==================== VARIABLES ==================== */
:root {
  --bg-page: #06060f;
  --bg-card: #0f0f20;
  --bg-input: #161630;
  --bg-sidebar: #0a0a18;
  --bg-header: rgba(8,8,18,0.85);
  --bg-right: #0a0a18;
  --border: #1e1e40;
  --border-hover: #2e2e55;
  --text-primary: #e8e8f4;
  --text-secondary: #9898b8;
  --text-muted: #5a5a78;
  --accent: #7c3aed;
  --accent-hover: #9b5de5;
  --accent-dim: #6429c4;
  --accent-glow: rgba(124, 58, 237, 0.12);
  --accent-glow-strong: rgba(124, 58, 237, 0.25);
  --success: #22c55e;
  --warning: #f59e0b;
  --danger: #ef4444;
  --banner-grad: linear-gradient(135deg, #6d28d9 0%, #a855f7 50%, #7c3aed 100%);
  --radius: 12px;
  --radius-sm: 8px;
  --shadow-card: 0 1px 3px rgba(0,0,0,0.3), 0 4px 20px rgba(0,0,0,0.15);
  --shadow-elevated: 0 8px 32px rgba(0,0,0,0.4);
  --sidebar-w: 230px;
  --right-w: 300px;
  --header-h: 56px;
  --font: 'Inter', system-ui, -apple-system, 'Segoe UI', sans-serif;
  --transition: 0.2s ease;
}

/* ==================== LIGHT THEME ==================== */
:root.light {
  --bg-page: #f4f4fa;
  --bg-card: #ffffff;
  --bg-input: #f0f0f8;
  --bg-sidebar: #fafaff;
  --bg-header: rgba(250,250,255,0.9);
  --bg-right: #fafaff;
  --border: #e0e0ee;
  --border-hover: #d0d0e0;
  --text-primary: #1a1a30;
  --text-secondary: #55556e;
  --text-muted: #8888a0;
  --accent-glow: rgba(124, 58, 237, 0.08);
  --accent-glow-strong: rgba(124, 58, 237, 0.15);
  --shadow-card: 0 1px 3px rgba(0,0,0,0.06), 0 4px 16px rgba(0,0,0,0.04);
  --shadow-elevated: 0 8px 32px rgba(0,0,0,0.1);
}

/* ==================== RESET ==================== */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; scroll-padding-top: calc(var(--header-h) + 24px); }

body {
  font-family: var(--font);
  background: var(--bg-page);
  color: var(--text-primary);
  font-size: 15px; line-height: 1.65;
  min-height: 100vh;
  transition: background var(--transition), color var(--transition);
}

/* ==================== HEADER ==================== */
#topBar {
  position: fixed; top: 0; left: 0; right: 0; height: var(--header-h);
  background: var(--bg-header); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 20px 0 calc(var(--sidebar-w) + 24px);
  z-index: 100; transition: background var(--transition), border-color var(--transition);
}
.header-left { display: flex; align-items: center; gap: 14px; min-width: 0; }
.header-left h1 { font-size: 15px; font-weight: 600; white-space: nowrap; letter-spacing: -0.2px; }
.client-badge {
  font-size: 12px; font-weight: 600; background: var(--accent-glow); color: var(--accent);
  padding: 3px 10px; border-radius: 20px; white-space: nowrap;
  max-width: 140px; overflow: hidden; text-overflow: ellipsis;
}
.header-right { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }

.save-status { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--text-muted); }
.save-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-muted); transition: background 0.3s; }
.save-status.saved .save-dot { background: var(--success); }
.save-status.saving .save-dot { background: var(--warning); animation: pulse 1s infinite; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.3} }

.progress-mini { display: flex; align-items: center; gap: 6px; }
.progress-ring { width: 28px; height: 28px; }
.progress-ring-bg { fill: none; stroke: var(--border); stroke-width: 3; }
.progress-ring-fill { fill: none; stroke: var(--accent); stroke-width: 3; stroke-linecap: round; transition: stroke-dashoffset 0.5s ease; transform: rotate(-90deg); transform-origin: 50% 50%; }
.progress-pct { font-size: 11px; font-weight: 700; color: var(--accent); min-width: 28px; }

.hdr-btn {
  font-size: 11px; font-weight: 600; padding: 5px 10px; border-radius: 6px;
  border: 1px solid var(--border); background: transparent; color: var(--text-secondary);
  cursor: pointer; transition: all var(--transition); white-space: nowrap;
}
.hdr-btn:hover { border-color: var(--accent); color: var(--accent); }
.hdr-btn.primary { background: var(--accent); border-color: var(--accent); color: #fff; }
.hdr-btn.primary:hover { background: var(--accent-hover); }

/* Theme toggle */
.theme-toggle {
  width: 36px; height: 20px; border-radius: 10px; border: none;
  background: var(--border); cursor: pointer; position: relative;
  transition: background var(--transition);
}
.theme-toggle::after {
  content: ''; position: absolute; top: 2px; left: 2px;
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--text-secondary); transition: all var(--transition);
}
:root.light .theme-toggle { background: var(--accent); }
:root.light .theme-toggle::after { left: 18px; background: #fff; }

/* ==================== SIDEBAR ==================== */
#sidebar {
  position: fixed; top: var(--header-h); left: 0; bottom: 0;
  width: var(--sidebar-w); background: var(--bg-sidebar);
  border-right: 1px solid var(--border); overflow-y: auto; z-index: 90;
  display: flex; flex-direction: column;
  transition: background var(--transition), border-color var(--transition);
}
.nav-brand {
  padding: 16px 16px 12px; border-bottom: 1px solid var(--border);
  font-size: 11px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1.5px; color: var(--accent);
}
.nav-group { padding: 12px 10px; flex: 1; }

.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 7px 10px; border-radius: 6px;
  color: var(--text-secondary); font-size: 12.5px; font-weight: 450;
  cursor: pointer; transition: all 0.15s; margin-bottom: 1px;
  text-decoration: none;
}
.nav-item:hover { background: var(--accent-glow); color: var(--text-primary); }
.nav-item.active { background: var(--accent-glow-strong); color: var(--accent); font-weight: 600; }

.nav-dot {
  width: 7px; height: 7px; border-radius: 50%;
  border: 1.5px solid var(--text-muted); flex-shrink: 0;
  transition: all var(--transition);
}
.nav-dot.partial { border-color: var(--accent); background: var(--accent-glow-strong); }
.nav-dot.complete { border-color: var(--success); background: var(--success); }

.nav-footer {
  padding: 10px; border-top: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 4px;
}
.nav-footer-btn {
  display: block; width: 100%; padding: 7px; font-size: 11px; font-weight: 500;
  text-align: center; border-radius: 6px; border: 1px solid var(--border);
  background: transparent; color: var(--text-muted); cursor: pointer;
  transition: all var(--transition);
}
.nav-footer-btn:hover { border-color: var(--accent); color: var(--accent); }

/* ==================== RIGHT PANEL ==================== */
#rightPanel {
  position: fixed; top: var(--header-h); right: 0; bottom: 0;
  width: var(--right-w); background: var(--bg-right);
  border-left: 1px solid var(--border); overflow-y: auto; z-index: 90;
  padding: 20px 16px;
  transition: background var(--transition), border-color var(--transition);
}
.rp-header {
  display: flex; align-items: center; gap: 6px;
  font-size: 10px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1.5px; color: var(--accent); margin-bottom: 16px;
}
.rp-live-dot {
  width: 6px; height: 6px; border-radius: 50%; background: var(--success);
  animation: pulse 2s infinite;
}
.rp-section { margin-bottom: 16px; }
.rp-label {
  font-size: 9px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1.2px; color: var(--text-muted); margin-bottom: 4px;
}
.rp-value {
  font-size: 13px; color: var(--text-primary); line-height: 1.5;
  word-break: break-word;
}
.rp-value.empty { color: var(--text-muted); font-style: italic; }
.rp-divider { border: none; border-top: 1px solid var(--border); margin: 14px 0; }

.rp-oneliner {
  background: var(--accent-glow); border: 1px solid rgba(124,58,237,0.2);
  border-radius: var(--radius-sm); padding: 12px 14px;
  font-size: 13px; line-height: 1.6; color: var(--text-primary);
  margin-bottom: 16px;
}
.rp-oneliner-label {
  font-size: 9px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1px; color: var(--accent); margin-bottom: 6px;
}

/* ==================== MAIN CONTENT ==================== */
#content {
  margin-left: var(--sidebar-w);
  margin-right: var(--right-w);
  padding: calc(var(--header-h) + 28px) 36px 80px 36px;
  transition: margin var(--transition);
}

.workshop-section {
  margin-bottom: 32px;
  animation: fadeUp 0.3s ease;
}
@keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

.section-banner {
  background: var(--banner-grad);
  color: #fff; font-size: 13px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 2.5px;
  text-align: center; padding: 14px 20px;
  border-radius: var(--radius) var(--radius) 0 0;
  position: relative; overflow: hidden;
}
.section-banner::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
  animation: shimmer 3s infinite;
}
@keyframes shimmer { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }

.section-body {
  background: var(--bg-card);
  border: 1px solid var(--border); border-top: none;
  border-radius: 0 0 var(--radius) var(--radius);
  padding: 28px;
  box-shadow: var(--shadow-card);
  transition: background var(--transition), border-color var(--transition);
}

.section-intro {
  color: var(--text-secondary); font-size: 13.5px;
  margin-bottom: 22px; line-height: 1.7;
}

/* ==================== FORM ELEMENTS ==================== */
.field-group { margin-bottom: 20px; }
.field-group:last-child { margin-bottom: 0; }
.field-group > label, .field-label {
  display: block; font-size: 13.5px; font-weight: 600;
  color: var(--text-primary); margin-bottom: 6px;
}
.field-sublabel {
  display: block; font-size: 11.5px; color: var(--text-muted);
  margin-top: -3px; margin-bottom: 7px; font-weight: 400;
}

textarea[data-field], textarea[data-key], input[data-field], input[data-key] {
  width: 100%; padding: 11px 14px;
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: var(--radius-sm); color: var(--text-primary);
  font-family: var(--font); font-size: 14px; line-height: 1.65;
  transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
}
textarea[data-field], textarea[data-key] { min-height: 64px; resize: none; overflow: hidden; }
textarea:focus, input[type="text"]:focus, input[type="date"]:focus {
  outline: none; border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
::placeholder { color: var(--text-muted); }

.field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.field-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }

/* Range */
.slider-group { margin-bottom: 14px; }
.slider-row { display: flex; align-items: center; gap: 12px; }
.slider-row input[type="range"] {
  flex: 1; height: 6px; -webkit-appearance: none; appearance: none;
  background: var(--border); border-radius: 3px; outline: none;
}
.slider-row input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%;
  background: var(--accent); cursor: pointer; border: 3px solid var(--bg-card);
  box-shadow: 0 0 8px rgba(124,58,237,0.4);
}
.slider-value { font-size: 20px; font-weight: 800; color: var(--accent); min-width: 30px; text-align: center; }
.slider-labels { display: flex; justify-content: space-between; font-size: 10px; color: var(--text-muted); margin-top: 4px; }

/* Triggers */
.trigger-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 8px; }
.trigger-card {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 12px; background: var(--bg-input);
  border: 1px solid var(--border); border-radius: var(--radius-sm);
  cursor: pointer; transition: all var(--transition); font-size: 12.5px; user-select: none;
}
.trigger-card:hover { border-color: var(--border-hover); }
.trigger-card:has(input:checked) { border-color: var(--accent); background: var(--accent-glow); }
.trigger-card input[type="checkbox"] { accent-color: var(--accent); width: 14px; height: 14px; }

/* ==================== DYNAMIC LISTS ==================== */
.dynamic-list { display: flex; flex-direction: column; gap: 10px; }
.dynamic-item {
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 16px;
  transition: border-color var(--transition);
}
.dynamic-item:hover { border-color: var(--border-hover); }
.item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.item-number {
  font-size: 10px; font-weight: 700; color: var(--accent);
  background: var(--accent-glow); padding: 2px 8px; border-radius: 10px;
}
.item-remove {
  font-size: 10px; color: var(--danger); background: none;
  border: 1px solid transparent; padding: 2px 8px;
  border-radius: 4px; cursor: pointer; opacity: 0.4; transition: all var(--transition);
}
.item-remove:hover { opacity: 1; border-color: var(--danger); }
.item-fields { display: flex; flex-direction: column; gap: 8px; }
.item-fields label { font-size: 11px; color: var(--text-muted); margin-bottom: -4px; }
.item-fields textarea { min-height: 40px; font-size: 13px; }
.item-fields input { font-size: 13px; }

.add-item-btn {
  display: flex; align-items: center; justify-content: center; gap: 4px;
  width: 100%; padding: 9px; background: transparent;
  border: 1px dashed var(--border); border-radius: var(--radius-sm);
  color: var(--text-muted); font-size: 12px; cursor: pointer; transition: all var(--transition);
}
.add-item-btn:hover { border-color: var(--accent); color: var(--accent); }

/* ==================== ROLE CARDS ==================== */
.role-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.role-card {
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 16px;
  transition: border-color var(--transition);
}
.role-card:hover { border-color: var(--border-hover); }
.role-card h4 { font-size: 13px; font-weight: 700; color: var(--accent-hover); margin-bottom: 2px; }
.role-card .role-desc { font-size: 10.5px; color: var(--text-muted); margin-bottom: 10px; }
.role-card .field-group { margin-bottom: 8px; }
.role-card label { font-size: 11px; }
.role-card textarea { min-height: 36px; font-size: 13px; }
.role-card input { font-size: 13px; }

/* ==================== TIPS ==================== */
.tip-box {
  background: var(--accent-glow); border-left: 3px solid var(--accent);
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  padding: 12px 14px; margin-bottom: 18px;
}
.tip-toggle {
  font-size: 12px; font-weight: 600; color: var(--accent-hover);
  cursor: pointer; display: flex; align-items: center; gap: 6px; user-select: none;
}
.tip-toggle::before { content: '+'; font-size: 14px; width: 16px; text-align: center; transition: transform 0.2s; }
.tip-box.open .tip-toggle::before { content: '-'; }
.tip-content {
  display: none; margin-top: 8px;
  font-size: 12.5px; color: var(--text-secondary); line-height: 1.7;
}
.tip-box.open .tip-content { display: block; }
.tip-content ul { padding-left: 16px; margin-top: 4px; }
.tip-content li { margin-bottom: 3px; }

/* ==================== HERO TABLE ==================== */
.hero-table {
  width: 100%; border-collapse: separate; border-spacing: 0;
  border-radius: var(--radius-sm); border: 1px solid var(--border); overflow: hidden;
}
.hero-table td { padding: 10px 12px; border-bottom: 1px solid var(--border); vertical-align: top; }
.hero-table tr:last-child td { border-bottom: none; }
.hero-table td:first-child {
  width: 38%; background: var(--accent-glow); font-size: 12.5px;
  font-weight: 500; color: var(--text-secondary);
}
.hero-table textarea {
  min-height: 32px; background: transparent; border: 1px solid transparent;
  padding: 2px 6px; font-size: 13px;
}
.hero-table textarea:focus { border-color: var(--accent); background: var(--bg-input); }

/* ==================== MODALS ==================== */
.modal-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,0.65); z-index: 200;
  justify-content: center; align-items: center;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 24px;
  max-width: 440px; width: 90%; box-shadow: var(--shadow-elevated);
}
.modal h2 { font-size: 16px; margin-bottom: 12px; }
.modal p { font-size: 13px; color: var(--text-secondary); margin-bottom: 14px; }
.modal-actions { display: flex; gap: 8px; justify-content: flex-end; }

.section-divider { border: none; border-top: 1px solid var(--border); margin: 18px 0; }

/* ==================== BACKUP REMINDER ==================== */
#backupReminder {
  display: none; position: fixed; bottom: 20px; right: calc(var(--right-w) + 16px);
  background: var(--bg-card); border: 1px solid var(--warning);
  border-radius: var(--radius); padding: 12px 16px;
  box-shadow: var(--shadow-elevated); z-index: 150; max-width: 280px; font-size: 12px;
}
#backupReminder .reminder-actions { margin-top: 8px; display: flex; gap: 6px; }

/* ==================== RESPONSIVE ==================== */
@media (max-width: 1300px) {
  #rightPanel { display: none; }
  #content { margin-right: 0; }
  #backupReminder { right: 16px; }
}
@media (max-width: 900px) {
  #sidebar { display: none; }
  #topBar { padding-left: 16px; }
  #content { margin-left: 0; padding: calc(var(--header-h) + 16px) 14px 60px; }
  .field-row, .field-row-3 { grid-template-columns: 1fr; }
  .role-grid { grid-template-columns: 1fr; }
}

/* ==================== DRIVE STATUS ==================== */
.drive-status {
  display: flex; align-items: center; gap: 5px;
  font-size: 11px; color: var(--text-muted); cursor: pointer;
  padding: 3px 8px; border-radius: 6px; border: 1px solid var(--border);
  background: transparent; transition: all var(--transition);
}
.drive-status:hover { border-color: var(--accent); color: var(--accent); }
.drive-status.connected { border-color: var(--success); color: var(--success); }
.drive-status .drive-icon { font-size: 13px; }

/* ==================== SESSION TIMER ==================== */
.session-timer {
  display: flex; align-items: center; gap: 5px;
  font-size: 11px; font-weight: 600; color: var(--text-muted);
  padding: 3px 8px; border-radius: 6px; background: var(--accent-glow);
  font-variant-numeric: tabular-nums;
}
.session-timer .timer-dot {
  width: 5px; height: 5px; border-radius: 50%; background: var(--success);
  animation: pulse 2s infinite;
}

/* ==================== TOAST NOTIFICATIONS ==================== */
#toastContainer {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  z-index: 300; display: flex; flex-direction: column-reverse; gap: 8px;
  pointer-events: none;
}
.toast {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 10px 18px;
  box-shadow: var(--shadow-elevated); font-size: 13px;
  color: var(--text-primary); pointer-events: auto;
  animation: toastIn 0.3s ease, toastOut 0.3s ease 2.7s forwards;
  display: flex; align-items: center; gap: 8px; white-space: nowrap;
}
.toast.success { border-color: var(--success); }
.toast.success::before { content: '\2713'; color: var(--success); font-weight: 700; }
.toast.warning { border-color: var(--warning); }
.toast.warning::before { content: '\26A0'; }
.toast.error { border-color: var(--danger); }
.toast.error::before { content: '\2717'; color: var(--danger); font-weight: 700; }
.toast.info { border-color: #3b82f6; }
.toast.info::before { content: '\2139'; color: #3b82f6; font-weight: 700; font-size: 14px; }
@keyframes toastIn { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }
@keyframes toastOut { from { opacity:1; } to { opacity:0; transform:translateY(-8px); } }

/* ==================== KEYBOARD SHORTCUT HELP ==================== */
#helpOverlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,0.7); z-index: 500;
  justify-content: center; align-items: center;
  backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
}
#helpOverlay.open { display: flex; }
.help-modal {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 28px 32px;
  max-width: 480px; width: 90%; box-shadow: var(--shadow-elevated);
  max-height: 80vh; overflow-y: auto;
}
.help-modal h2 { font-size: 16px; margin-bottom: 16px; color: var(--accent); }
.help-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 7px 0; border-bottom: 1px solid var(--border);
}
.help-row:last-child { border-bottom: none; }
.help-key {
  display: inline-flex; align-items: center; gap: 4px;
}
.help-key kbd {
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: 4px; padding: 2px 7px; font-size: 11px;
  font-family: var(--font); font-weight: 600; color: var(--text-primary);
  box-shadow: 0 1px 0 var(--border);
}
.help-desc { font-size: 13px; color: var(--text-secondary); }
.help-section-title {
  font-size: 10px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1.5px; color: var(--text-muted); padding-top: 12px; margin-bottom: 4px;
}

/* ==================== COLLAPSIBLE SECTIONS ==================== */
.section-banner { cursor: pointer; user-select: none; }
.section-banner .collapse-indicator {
  position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
  font-size: 10px; opacity: 0.6; transition: transform 0.2s;
  z-index: 2;
}
.workshop-section.collapsed .section-banner .collapse-indicator { transform: translateY(-50%) rotate(-90deg); }
.workshop-section.collapsed .section-body {
  max-height: 0; padding: 0 28px; overflow: hidden; border: none;
  opacity: 0; transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.2s ease;
}
.section-body {
  max-height: 5000px; opacity: 1;
  transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.2s ease;
}

/* ==================== FIELD HIGHLIGHT ON EMPTY CRITICAL ==================== */
.field-group.critical-empty > label::after {
  content: 'Required'; font-size: 9px; font-weight: 600;
  color: var(--warning); margin-left: 8px; opacity: 0.7;
}

/* ==================== SEARCH HIGHLIGHT ==================== */
.search-highlight {
  animation: highlightPulse 2s ease;
}
@keyframes highlightPulse {
  0% { box-shadow: 0 0 0 3px rgba(124,58,237,0.5); }
  100% { box-shadow: 0 0 0 3px transparent; }
}

/* ==================== NAV PROGRESS BADGE ==================== */
.nav-progress {
  font-size: 9px; font-weight: 600; color: var(--text-muted);
  margin-left: auto; font-variant-numeric: tabular-nums;
  opacity: 0.6; transition: all var(--transition);
}
.nav-progress.done { color: var(--success); opacity: 1; }

/* ==================== AI COACH LABELS ==================== */
.coach-card-label.ai {
  color: #a855f7; background: rgba(168,85,247,0.1);
  padding: 2px 6px; border-radius: 3px; display: inline-block;
}

/* ==================== RESEARCH CARD POLISH ==================== */
.research-card { border-color: rgba(168,85,247,0.3); }
.research-sources { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px; }
.research-source {
  font-size: 10px; padding: 2px 8px; border-radius: 10px;
  background: var(--accent-glow); color: var(--accent);
  text-decoration: none; transition: all var(--transition);
}
.research-source:hover { background: var(--accent); color: #fff; }
.research-web-badge {
  font-size: 8px; font-weight: 700; background: var(--success);
  color: #fff; padding: 1px 5px; border-radius: 3px;
  margin-left: 4px; vertical-align: middle;
}
.research-chip {
  font-size: 11px; padding: 4px 10px; border-radius: 12px;
  background: var(--bg-input); border: 1px solid var(--border);
  color: var(--text-secondary); cursor: pointer; transition: all var(--transition);
}
.research-chip:hover { border-color: var(--accent); color: var(--accent); }

/* ==================== COPY BUTTON ON BANNERS ==================== */
.section-banner { display: flex; align-items: center; justify-content: center; position: relative; }
.copy-section-btn {
  position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  background: rgba(255,255,255,0.15); border: none; color: rgba(255,255,255,0.7);
  width: 28px; height: 28px; border-radius: 6px; cursor: pointer;
  font-size: 13px; display: flex; align-items: center; justify-content: center;
  opacity: 0; transition: all 0.2s; z-index: 2;
}
.section-banner:hover .copy-section-btn { opacity: 1; }
.copy-section-btn:hover { background: rgba(255,255,255,0.25); color: #fff; }
.copy-section-btn.copied { background: var(--success); color: #fff; opacity: 1; }

/* ==================== MESSAGING MATRIX ==================== */
.matrix-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.matrix-card {
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 16px; transition: border-color var(--transition);
}
.matrix-card:hover { border-color: var(--border-hover); }
.matrix-card h4 {
  font-size: 10px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1px; color: var(--accent); margin-bottom: 8px;
}
.matrix-card p { font-size: 13px; line-height: 1.6; color: var(--text-primary); }
.matrix-card p.empty-hint { color: var(--text-muted); font-style: italic; font-size: 12px; }
.matrix-card.full-width { grid-column: 1 / -1; }
.matrix-copy-all {
  margin-top: 14px; display: flex; justify-content: center;
}

/* ==================== SECTION GLOW ON COMPLETE ==================== */
.workshop-section.section-complete .section-banner::before {
  content: ''; position: absolute; inset: 0; border-radius: var(--radius) var(--radius) 0 0;
  background: linear-gradient(135deg, rgba(34,197,94,0.15), transparent);
  pointer-events: none;
}

/* ==================== PHASE LABELS ==================== */
.nav-phase {
  font-size: 9px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1.8px; color: var(--text-muted);
  padding: 14px 10px 4px; margin-top: 4px;
}
.nav-phase:first-child { margin-top: 0; padding-top: 6px; }

/* ==================== AI COACH TAB ==================== */
.rp-tabs { display: flex; gap: 0; margin-bottom: 14px; border-bottom: 1px solid var(--border); }
.rp-tab {
  flex: 1; padding: 8px 4px; text-align: center; font-size: 11px; font-weight: 600;
  color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent;
  transition: all var(--transition); text-transform: uppercase; letter-spacing: 0.8px;
}
.rp-tab:hover { color: var(--text-secondary); }
.rp-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
.rp-tab-content { display: none; }
.rp-tab-content.active { display: block; }

.coach-card {
  background: var(--bg-input); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 12px 14px; margin-bottom: 8px;
  transition: border-color var(--transition);
}
.coach-card:hover { border-color: var(--border-hover); }
.coach-card-label {
  font-size: 9px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1px; margin-bottom: 4px;
}
.coach-card-label.suggest { color: var(--accent); }
.coach-card-label.missing { color: var(--warning); }
.coach-card-label.question { color: var(--success); }
.coach-card p { font-size: 12.5px; color: var(--text-secondary); line-height: 1.6; }
.coach-empty { text-align: center; padding: 24px 12px; color: var(--text-muted); font-size: 12px; }

/* Panel intro + coach legend */
.rp-intro {
  font-size: 11.5px; color: var(--text-muted); line-height: 1.6;
  margin-bottom: 14px; padding-bottom: 12px; border-bottom: 1px solid var(--border);
}
.coach-how-it-works {
  display: flex; flex-direction: column; gap: 5px;
  margin-bottom: 14px; padding: 10px 12px;
  background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border);
}
.coach-how-item {
  display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--text-secondary); line-height: 1.4;
}
.coach-how-item strong { color: var(--text-primary); }
.coach-how-icon { font-size: 8px; flex-shrink: 0; }
.coach-research-label {
  font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px;
  color: var(--text-muted); margin-top: 10px; margin-bottom: 6px;
}
.coach-api-section {
  margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);
}
.coach-api-btn {
  width: 100%; padding: 8px; font-size: 11px; font-weight: 600;
  border-radius: 6px; border: 1px solid var(--accent); background: var(--accent-glow);
  color: var(--accent); cursor: pointer; transition: all var(--transition);
}
.coach-api-btn:hover { background: var(--accent); color: #fff; }
.coach-api-btn:disabled { opacity: 0.4; cursor: not-allowed; }

/* ==================== APPS SCRIPT CONFIG ==================== */
.config-input {
  width: 100%; padding: 10px 12px; background: var(--bg-input);
  border: 1px solid var(--border); border-radius: 6px;
  color: var(--text-primary); font-size: 13px; font-family: var(--font);
}
.config-input:focus { outline: none; border-color: var(--accent); }
.config-hint { font-size: 11px; color: var(--text-muted); margin-top: 6px; line-height: 1.5; }


/* ==================== ACCORDION (ACQ-style collapsible) ==================== */
.accordion { margin-top: 20px; border: 1px solid var(--border); border-radius: var(--radius-sm); overflow: hidden; }
.accordion-header {
  display: flex; align-items: center; gap: 10px; padding: 12px 16px;
  background: var(--bg-input); cursor: pointer; user-select: none;
  transition: background var(--transition);
}
.accordion-header:hover { background: var(--accent-glow); }
.accordion-title { font-size: 13.5px; font-weight: 600; flex: 1; }
.accordion-count {
  font-size: 11px; color: var(--text-muted); background: var(--bg-page);
  padding: 2px 8px; border-radius: 10px; font-weight: 500;
}
.accordion-arrow {
  font-size: 12px; color: var(--text-muted); transition: transform 0.2s;
}
.accordion.open .accordion-arrow { transform: rotate(90deg); }
.accordion-body {
  max-height: 0; overflow: hidden; transition: max-height 0.3s ease;
  background: var(--bg-card);
}
.accordion.open .accordion-body { max-height: 4000px; }
.accordion-body-inner { padding: 16px; }

/* ==================== FIELD GRID (2-col) ==================== */
.field-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 14px 20px;
}
.field-grid .field-group { margin-bottom: 0; }
.field-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px 20px; }
@media (max-width: 900px) { .field-grid, .field-grid-3 { grid-template-columns: 1fr; } }

/* ==================== SELECT/DROPDOWN ==================== */
select[data-field] {
  width: 100%; padding: 10px 12px; border-radius: var(--radius-sm);
  background: var(--bg-input); border: 1px solid var(--border);
  color: var(--text-primary); font-size: 14px; font-family: var(--font);
  cursor: pointer; transition: border-color var(--transition);
  -webkit-appearance: none; appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239898b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center;
}
select[data-field]:hover { border-color: var(--border-hover); }
select[data-field]:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 2px var(--accent-glow); }
:root.light select[data-field] {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2355556e' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
}

/* ==================== AI COACH AUTO-SUGGESTIONS ==================== */
.coach-loading {
  display: flex; align-items: center; gap: 8px; padding: 10px 14px;
  background: var(--bg-input); border-radius: var(--radius-sm); margin-bottom: 8px;
  font-size: 12px; color: var(--text-secondary); border: 1px solid var(--border);
}
.coach-loading .spinner { width: 14px; height: 14px; border: 2px solid var(--border);
  border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.coach-card-label.ai { background: #6366f1; }
.coach-research-row {
  display: flex; gap: 6px; padding-top: 10px; border-top: 1px solid var(--border); margin-top: 10px;
}
.coach-research-row input {
  flex: 1; padding: 8px 10px; border-radius: 6px; border: 1px solid var(--border);
  background: var(--bg-input); color: var(--text-primary); font-size: 12.5px; font-family: var(--font);
}
.coach-research-row input:focus { border-color: var(--accent); outline: none; }
.coach-research-row button {
  padding: 8px 14px; border-radius: 6px; border: none;
  background: #6366f1; color: #fff; font-size: 12px; font-weight: 600;
  cursor: pointer; white-space: nowrap;
}
.coach-research-row button:hover { background: #4f46e5; }
.coach-research-row button:disabled { opacity: 0.5; cursor: wait; }

/* Research results */
.research-card { border-color: rgba(99,102,241,0.3); }
.research-sources {
  display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px; padding-top: 8px;
  border-top: 1px solid var(--border);
}
.research-source {
  font-size: 10px; padding: 2px 8px; border-radius: 10px;
  background: var(--accent-glow); color: var(--accent); text-decoration: none;
  transition: all 0.15s; border: 1px solid transparent;
}
.research-source:hover { border-color: var(--accent); }
.research-web-badge {
  display: inline-block; font-size: 8px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 0.5px; background: #10b981; color: #fff; padding: 1px 5px;
  border-radius: 3px; margin-left: 4px; vertical-align: middle;
}
.research-suggestions {
  display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 6px;
}
.research-chip {
  font-size: 10px; padding: 3px 8px; border-radius: 10px;
  background: var(--bg-input); border: 1px solid var(--border);
  color: var(--text-secondary); cursor: pointer; transition: all 0.15s;
  white-space: nowrap; max-width: 100%; overflow: hidden; text-overflow: ellipsis;
}
.research-chip:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

/* ==================== CMD+K SEARCH ==================== */
.search-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
  z-index: 500; justify-content: center; padding-top: 18vh;
}
.search-overlay.open { display: flex; }
.search-modal {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); width: 560px; max-width: 90vw;
  box-shadow: 0 24px 80px rgba(0,0,0,0.5); overflow: hidden; max-height: 60vh;
  display: flex; flex-direction: column;
}
.search-input-wrap {
  display: flex; align-items: center; gap: 10px;
  padding: 16px; border-bottom: 1px solid var(--border);
}
.search-input-wrap svg { width: 20px; height: 20px; color: var(--text-muted); flex-shrink: 0; }
.search-input {
  flex: 1; background: none; border: none; outline: none;
  font-size: 16px; color: var(--text-primary); font-family: var(--font);
}
.search-input::placeholder { color: var(--text-muted); }
.search-results { overflow-y: auto; max-height: 400px; padding: 8px; }
.search-result {
  display: flex; flex-direction: column; gap: 2px;
  padding: 10px 12px; border-radius: 6px; cursor: pointer; transition: background 0.1s;
}
.search-result:hover, .search-result.selected { background: var(--accent-glow-strong); }
.search-result-section { font-size: 10px; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 0.8px; }
.search-result-label { font-size: 13px; font-weight: 500; color: var(--text-primary); }
.search-result-value { font-size: 12px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.search-empty { padding: 24px; text-align: center; color: var(--text-muted); font-size: 13px; }
.search-hint { font-size: 11px; color: var(--text-muted); padding: 8px 16px; border-top: 1px solid var(--border); text-align: center; }
[data-field].search-highlight {
  animation: highlightPulse 2s ease;
}
@keyframes highlightPulse {
  0%,30% { box-shadow: 0 0 0 3px rgba(124,58,237,0.35), 0 0 20px rgba(124,58,237,0.15); }
  100% { box-shadow: none; }
}

/* ==================== EXPORT DROPDOWN ==================== */
.export-wrap { position: relative; }
.export-menu {
  display: none; position: absolute; top: 100%; right: 0; margin-top: 6px;
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius-sm); padding: 4px;
  box-shadow: var(--shadow-elevated); min-width: 200px; z-index: 120;
}
.export-wrap.open .export-menu { display: block; }
.export-menu-item {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 12px; border-radius: 4px; font-size: 12.5px;
  color: var(--text-primary); cursor: pointer; border: none;
  background: none; width: 100%; text-align: left; font-family: var(--font);
  transition: background 0.1s;
}
.export-menu-item:hover { background: var(--accent-glow); color: var(--accent); }
.export-menu-item .em-icon { font-size: 14px; width: 20px; text-align: center; opacity: 0.7; }

/* ==================== HAMBURGER MENU ==================== */
.hamburger {
  display: none; width: 36px; height: 36px; border: none;
  background: none; cursor: pointer; flex-direction: column;
  justify-content: center; align-items: center; gap: 5px; padding: 0;
}
.hamburger span { width: 20px; height: 2px; background: var(--text-secondary); border-radius: 1px; transition: all 0.2s; }
@media (max-width: 900px) {
  .hamburger { display: flex; }
  #sidebar.mobile-open { display: flex !important; z-index: 200; box-shadow: var(--shadow-elevated); }
}

/* Nav progress badge - see main definition below */

/* ==================== SCROLLBAR ==================== */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--border-hover); }

/* ==================== VISUAL POLISH ==================== */
/* Smooth input focus transition */
textarea[data-field]:focus, textarea[data-key]:focus,
input[data-field]:focus, input[data-key]:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow), 0 0 20px rgba(124,58,237,0.06);
  background: color-mix(in srgb, var(--bg-input) 95%, var(--accent) 5%);
}

/* Filled field subtle indicator */
textarea[data-field]:not(:placeholder-shown):not(:focus),
input[data-field]:not(:placeholder-shown):not(:focus) {
  border-color: color-mix(in srgb, var(--border) 70%, var(--success) 30%);
}

/* Card hover lift */
.dynamic-item:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.coach-card:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
.matrix-card:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

/* Smooth accordion transition */
.accordion-body { transition: max-height 0.4s cubic-bezier(0.4,0,0.2,1); }

/* Section banner hover shine */
.section-banner:hover::after { animation: shimmer 1.5s infinite; }

/* Active nav item left border */
.nav-item.active { border-left: 2px solid var(--accent); padding-left: 8px; }

/* Coach card entrance animation */
.coach-card { animation: slideIn 0.25s ease; }
@keyframes slideIn { from { opacity: 0; transform: translateX(-8px); } to { opacity: 1; transform: translateX(0); } }

/* Progress ring glow when > 80% */
.progress-ring-fill.high { filter: drop-shadow(0 0 6px rgba(124,58,237,0.5)); }

/* Smooth section body transition */
.section-body { transition: background var(--transition), border-color var(--transition), box-shadow var(--transition); }
.section-body:hover { box-shadow: var(--shadow-card), 0 0 0 1px var(--border-hover); }

/* Tooltip style for nav phase labels */
.nav-phase { position: relative; }
.nav-phase::after { content: ''; display: block; width: 20px; height: 1px; background: var(--border); margin-top: 4px; }

/* Better dropdown styling */
select[data-field] { transition: border-color var(--transition), box-shadow var(--transition), background var(--transition); }
select[data-field]:focus { box-shadow: 0 0 0 3px var(--accent-glow), 0 0 20px rgba(124,58,237,0.06); }

/* Keyboard shortcut hint */
.kbd { display: inline-block; font-size: 10px; padding: 1px 5px; border-radius: 3px; background: var(--bg-input); border: 1px solid var(--border); color: var(--text-muted); font-family: monospace; }

/* ==================== PRINT ==================== */
@media print {
  #topBar, #sidebar, #rightPanel, .tip-box, .add-item-btn, .item-remove,
  .hdr-btn, .nav-footer, #backupReminder, #toastContainer, .copy-section-btn { display: none !important; }
  #content { margin: 0; padding: 0; max-width: 100%; }
  body { background: #fff; color: #111; }
  .section-banner { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  .section-body { border: 1px solid #ccc; }
  textarea, input { border: 1px solid #ccc !important; background: #fafafa !important; color: #111 !important; }
}
</style>
</head>
<body>

<!-- ==================== HEADER ==================== -->
<header id="topBar">
  <div class="header-left">
    <button class="hamburger" onclick="document.getElementById('sidebar').classList.toggle('mobile-open')"><span></span><span></span><span></span></button>
    <h1>Value Proposition Workshop</h1>
    <span class="client-badge" id="clientBadge">-</span>
  </div>
  <div class="header-right">
    <div class="session-timer"><span class="timer-dot"></span><span id="timerDisplay">0:00</span></div>
    <div class="save-status" id="saveStatus"><span class="save-dot"></span><span id="saveText">Ready</span></div>
    <div class="progress-mini">
      <svg class="progress-ring" viewBox="0 0 32 32">
        <circle class="progress-ring-bg" cx="16" cy="16" r="13"/>
        <circle class="progress-ring-fill" id="progressRing" cx="16" cy="16" r="13" stroke-dasharray="81.68" stroke-dashoffset="81.68"/>
      </svg>
      <span class="progress-pct" id="progressValue">0%</span>
    </div>
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode"></button>
    <button class="drive-status" id="driveBtn" onclick="handleDriveConnect()" title="Connect Google Drive for auto-backup"><span class="drive-icon">&#9729;</span><span id="driveLabel">Connect Drive</span></button>
    <button class="hdr-btn" onclick="openSearch()" title="Search fields (Cmd+K)" style="font-size:13px;padding:5px 8px">&#128269;</button>
    <button class="hdr-btn" onclick="document.getElementById('helpOverlay').classList.toggle('open')" title="Keyboard shortcuts (?)" style="font-size:13px;padding:5px 8px">?</button>
    <div class="export-wrap" id="exportWrap">
      <button class="hdr-btn primary" onclick="this.parentElement.classList.toggle('open')">Export &#9662;</button>
      <div class="export-menu">
        <button class="export-menu-item" onclick="exportMarkdown();this.closest('.export-wrap').classList.remove('open')"><span class="em-icon">&#128196;</span>Copy as Markdown</button>
        <button class="export-menu-item" onclick="exportPDF();this.closest('.export-wrap').classList.remove('open')"><span class="em-icon">&#128462;</span>Generate PDF Report</button>
        <button class="export-menu-item" onclick="downloadBackup();this.closest('.export-wrap').classList.remove('open')"><span class="em-icon">&#128190;</span>Download JSON Backup</button>
      </div>
    </div>
  </div>
</header>

<!-- ==================== SIDEBAR ==================== -->
<nav id="sidebar">
  <div class="nav-brand">Dopamine Digital</div>
  <div class="nav-group">
    <a class="nav-item" data-nav="s0" onclick="goToSection('s0')"><span class="nav-dot"></span>Setup</a>
    <a class="nav-item" data-nav="sBS" onclick="goToSection('sBS')"><span class="nav-dot"></span>Business Snapshot</a>
    <div class="nav-phase">Who - Your ICP</div>
    <a class="nav-item" data-nav="s1" onclick="goToSection('s1')"><span class="nav-dot"></span>Dream Client Profile</a>
    <a class="nav-item" data-nav="s2" onclick="goToSection('s2')"><span class="nav-dot"></span>Psychographic Depth</a>
    <a class="nav-item" data-nav="sRI" onclick="goToSection('sRI')"><span class="nav-dot"></span>Revenue Intelligence</a>
    <a class="nav-item" data-nav="sCM" onclick="goToSection('sCM')"><span class="nav-dot"></span>Channel & Media</a>
    <a class="nav-item" data-nav="sLM" onclick="goToSection('sLM')"><span class="nav-dot"></span>Language & Messaging</a>
    <div class="nav-phase">Why Now - Timing</div>
    <a class="nav-item" data-nav="s3" onclick="goToSection('s3')"><span class="nav-dot"></span>Trigger Events</a>
    <a class="nav-item" data-nav="s4" onclick="goToSection('s4')"><span class="nav-dot"></span>Buying Committee</a>
    <a class="nav-item" data-nav="sBB" onclick="goToSection('sBB')"><span class="nav-dot"></span>Buying Behavior</a>
    <div class="nav-phase">What - Your Solution</div>
    <a class="nav-item" data-nav="s6" onclick="goToSection('s6')"><span class="nav-dot"></span>Case Studies</a>
    <a class="nav-item" data-nav="s7" onclick="goToSection('s7')"><span class="nav-dot"></span>Before / After</a>
    <a class="nav-item" data-nav="s8" onclick="goToSection('s8')"><span class="nav-dot"></span>Features & Benefits</a>
    <a class="nav-item" data-nav="s9" onclick="goToSection('s9')"><span class="nav-dot"></span>Guarantee & Offer</a>
    <div class="nav-phase">How - Positioning</div>
    <a class="nav-item" data-nav="s10" onclick="goToSection('s10')"><span class="nav-dot"></span>Competitive Position</a>
    <a class="nav-item" data-nav="sSP" onclick="goToSection('sSP')"><span class="nav-dot"></span>Sales Process</a>
    <a class="nav-item" data-nav="s5" onclick="goToSection('s5')"><span class="nav-dot"></span>Negative Personas</a>
    <a class="nav-item" data-nav="sER" onclick="goToSection('sER')"><span class="nav-dot"></span>Expansion & Retention</a>
    <div class="nav-phase">Story - Narrative</div>
    <a class="nav-item" data-nav="s11" onclick="goToSection('s11')"><span class="nav-dot"></span>Hero Story</a>
    <a class="nav-item" data-nav="s12" onclick="goToSection('s12')"><span class="nav-dot"></span>Objections & FAQs</a>
    <a class="nav-item" data-nav="s13" onclick="goToSection('s13')"><span class="nav-dot"></span>Messaging Matrix</a>
  </div>
  <div class="nav-footer">
    <button class="nav-footer-btn" onclick="showNewWorkshop()">+ New Workshop</button>
    <button class="nav-footer-btn" onclick="showLoadDialog()">Load Previous</button>
    <button class="nav-footer-btn" onclick="restoreFromDrive()">Restore from Drive</button>
    <label class="nav-footer-btn" style="cursor:pointer">Import File<input type="file" accept=".json" style="display:none" onchange="importBackup(this.files[0])"></label>
  </div>
  <div style="padding:8px 10px;border-top:1px solid var(--border);text-align:center;">
    <div style="font-size:9px;color:var(--text-muted);line-height:1.8;">
      <span class="kbd">&#8984;S</span> Save &nbsp; <span class="kbd">&#8984;K</span> Search
    </div>
    <div style="font-size:9px;color:var(--text-muted);margin-top:4px;opacity:0.6;">Powered by Dopamine Digital</div>
  </div>
</nav>

<!-- ==================== RIGHT PANEL: LIVE SUMMARY ==================== -->
<aside id="rightPanel">
  <div class="rp-tabs">
    <div class="rp-tab active" onclick="switchRPTab('summary')">Summary</div>
    <div class="rp-tab" onclick="switchRPTab('coach')">AI Coach</div>
  </div>
  <div id="rpSummaryTab" class="rp-tab-content active">
    <div class="rp-header"><span class="rp-live-dot"></span> Live Summary</div>
    <div class="rp-intro">Your value proposition builds itself as you fill in sections. This panel updates in real-time to show the key elements.</div>
    <div id="liveSummary"></div>
  </div>
  <div id="rpCoachTab" class="rp-tab-content">
    <div class="rp-header"><span class="rp-live-dot"></span> AI Coach</div>
    <div class="rp-intro">Your AI facilitator watches what you type and gives tailored suggestions. It flags missing fields, asks deeper questions, and helps sharpen your answers.</div>
    <div class="coach-how-it-works">
      <div class="coach-how-item"><span class="coach-how-icon" style="color:var(--warning);">&#9679;</span><span><strong>Missing</strong> - Critical fields you haven't filled yet</span></div>
      <div class="coach-how-item"><span class="coach-how-icon" style="color:var(--accent);">&#9679;</span><span><strong>Suggestion</strong> - Ways to improve what you've written</span></div>
      <div class="coach-how-item"><span class="coach-how-icon" style="color:var(--success);">&#9679;</span><span><strong>Question</strong> - Clarifying questions to unlock deeper insight</span></div>
      <div class="coach-how-item"><span class="coach-how-icon" style="color:#6366f1;">&#9679;</span><span><strong>AI</strong> - Claude-powered analysis of your inputs</span></div>
    </div>
    <div id="coachAiLoading" style="display:none" class="coach-loading"><div class="spinner"></div> Analyzing your inputs...</div>
    <div id="coachSuggestions"></div>
    <div class="coach-research-label">Ask a question and get live data, benchmarks, or examples:</div>
    <div id="researchSuggestions" class="research-suggestions"></div>
    <div class="coach-research-row">
      <input type="text" id="coachResearchInput" placeholder="e.g. &quot;average SaaS churn rate&quot;" onkeydown="if(event.key==='Enter'){event.preventDefault();runResearch();}" onfocus="showResearchSuggestions()">
      <button onclick="runResearch()">Research</button>
    </div>
  </div>
</aside>

<!-- ==================== MAIN CONTENT ==================== -->
<main id="content">

<!-- S0: SETUP -->
<section id="s0" class="workshop-section">
  <div class="section-banner">Workshop Setup</div>
  <div class="section-body">
    <div class="field-row-3">
      <div class="field-group"><label>Client / Company</label><input type="text" data-field="clientName" placeholder="e.g. Phellos"></div>
      <div class="field-group"><label>Date</label><input type="date" data-field="workshopDate"></div>
      <div class="field-group"><label>Facilitator</label><input type="text" data-field="facilitator" placeholder="e.g. Jordan"></div>
    </div>
    <div class="field-group"><label>Attendees</label><input type="text" data-field="attendees" placeholder="Names and roles of everyone in the session"></div>
    <div class="field-group"><label>Session Objectives</label><textarea data-field="sessionGoals" placeholder="What do we want to accomplish today?"></textarea></div>
  </div>
</section>


<!-- SBS: BUSINESS SNAPSHOT (ACQ AI-inspired) -->
<section id="sBS" class="workshop-section">
  <div class="section-banner">Business Snapshot</div>
  <div class="section-body">
    <p class="section-intro">Quick diagnostic of the business. These numbers help us benchmark, identify constraints, and feed AI with the full picture. Fill what you know - skip what you don't.</p>
    <div class="field-grid">
      <div class="field-group"><label>Website</label><input type="text" data-field="bs_website" placeholder="https://example.com"></div>
      <div class="field-group"><label>Primary Product / Service</label><input type="text" data-field="bs_product" placeholder="e.g. Fractional CFO for startups"></div>
      <div class="field-group"><label>Annual Revenue</label><input type="text" data-field="bs_annualRevenue" placeholder="e.g. $2,000,000"></div>
      <div class="field-group"><label>Number of Employees</label><input type="text" data-field="bs_employees" placeholder="e.g. 12"></div>
      <div class="field-group"><label>New Customers / Month</label><input type="text" data-field="bs_newCustomersMonth" placeholder="e.g. 4"></div>
      <div class="field-group"><label>Average Deal Size</label><input type="text" data-field="bs_avgDealSize" placeholder="e.g. $3,000/mo"></div>
      <div class="field-group">
        <label>Primary Selling Mechanism</label>
        <select data-field="bs_sellingMechanism"><option value="">Select...</option><option>Sales Team (Outbound)</option><option>Inbound / Self-Serve</option><option>Founder-Led Sales</option><option>Partnerships / Channel</option><option>Community-Led</option><option>Product-Led Growth</option><option>Hybrid</option></select>
      </div>
      <div class="field-group">
        <label>Primary Delivery Type</label>
        <select data-field="bs_deliveryType"><option value="">Select...</option><option>Done-For-You (Service)</option><option>Done-With-You (Coaching)</option><option>DIY / Self-Serve</option><option>SaaS / Software</option><option>Physical Product</option><option>Hybrid</option></select>
      </div>
      <div class="field-group">
        <label>Primary Lead Source</label>
        <select data-field="bs_leadSource"><option value="">Select...</option><option>Inbound Marketing / Content</option><option>Outbound Sales / Cold</option><option>Referrals / Word of Mouth</option><option>Paid Ads</option><option>SEO / Organic</option><option>Partnerships</option><option>Events / Speaking</option><option>Community / Social</option></select>
      </div>
      <div class="field-group">
        <label>Primary Advertising Mode</label>
        <select data-field="bs_advertisingMode"><option value="">Select...</option><option>Paid Search (Google)</option><option>Paid Social (Meta/LinkedIn)</option><option>Organic Content</option><option>Email Marketing</option><option>Cold Outreach</option><option>Events / Conferences</option><option>PR / Media</option><option>None Currently</option></select>
      </div>
      <div class="field-group"><label>Biggest Growth Constraint</label><input type="text" data-field="bs_growthConstraint" placeholder="e.g. Lead quality, sales capacity, delivery bandwidth"></div>
      <div class="field-group">
        <label>Current Tech Sophistication</label>
        <select data-field="bs_techStatus"><option value="">Select...</option><option>Basic (Spreadsheets, manual)</option><option>Developing (Some tools, no integrations)</option><option>Moderate (CRM + key tools connected)</option><option>Advanced (Full stack, automated workflows)</option><option>Enterprise (Custom systems, data team)</option></select>
      </div>
    </div>

    <div class="accordion" id="accSalesMetrics">
      <div class="accordion-header" onclick="toggleAccordion('accSalesMetrics')">
        <span class="accordion-title">Sales & Pipeline Metrics</span>
        <span class="accordion-count">12 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>Sales Cycle Length (days)</label><input type="text" data-field="bs_salesCycle" placeholder="e.g. 21"></div>
          <div class="field-group"><label>Close Rate (%)</label><input type="text" data-field="bs_closeRate" placeholder="e.g. 30"></div>
          <div class="field-group"><label>Qualified Leads / Month</label><input type="text" data-field="bs_qualifiedLeads" placeholder="e.g. 40"></div>
          <div class="field-group"><label>Sales Team Size</label><input type="text" data-field="bs_salesTeamSize" placeholder="e.g. 3"></div>
          <div class="field-group"><label>Monthly Marketing Spend</label><input type="text" data-field="bs_monthlySpend" placeholder="e.g. $5,000"></div>
          <div class="field-group"><label>Total Pipeline Value</label><input type="text" data-field="bs_pipelineValue" placeholder="e.g. $250,000"></div>
          <div class="field-group"><label>Monthly Leads / Visitors</label><input type="text" data-field="bs_monthlyLeads" placeholder="e.g. 2,000"></div>
          <div class="field-group"><label>Conversion Rate (%)</label><input type="text" data-field="bs_conversionRate" placeholder="e.g. 2"></div>
          <div class="field-group"><label>Lead-to-Customer Rate (%)</label><input type="text" data-field="bs_leadToCustomer" placeholder="e.g. 15"></div>
          <div class="field-group"><label>Follow-up SLA</label><input type="text" data-field="bs_followUpSLA" placeholder="e.g. Reply within 24 hours"></div>
          <div class="field-group"><label>Competitors</label><textarea data-field="bs_competitors" placeholder="Top 3-5 competitors and what they do differently"></textarea></div>
          <div class="field-group"><label>Messaging Angles</label><textarea data-field="bs_messagingAngles" placeholder="Current main messages / positioning themes"></textarea></div>
        </div>
      </div></div>
    </div>

    <div class="accordion" id="accCustomerEcon">
      <div class="accordion-header" onclick="toggleAccordion('accCustomerEcon')">
        <span class="accordion-title">Customer Economics</span>
        <span class="accordion-count">7 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>Total Customers</label><input type="text" data-field="bs_totalCustomers" placeholder="e.g. 120"></div>
          <div class="field-group"><label>Average Order Value</label><input type="text" data-field="bs_aov" placeholder="e.g. $3,000"></div>
          <div class="field-group"><label>Customer Acquisition Cost</label><input type="text" data-field="bs_cac" placeholder="e.g. $500"></div>
          <div class="field-group"><label>Customer Lifetime Value</label><input type="text" data-field="bs_ltv" placeholder="e.g. $18,000"></div>
          <div class="field-group"><label>Monthly Churn Rate (%)</label><input type="text" data-field="bs_churnRate" placeholder="e.g. 4"></div>
          <div class="field-group"><label>NPS Score</label><input type="text" data-field="bs_nps" placeholder="e.g. 55"></div>
          <div class="field-group"><label>Customer Segments</label><textarea data-field="bs_customerSegments" placeholder="Different types of customers you serve"></textarea></div>
        </div>
      </div></div>
    </div>

    <div class="accordion" id="accFinancials">
      <div class="accordion-header" onclick="toggleAccordion('accFinancials')">
        <span class="accordion-title">Financials</span>
        <span class="accordion-count">8 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>Monthly Revenue</label><input type="text" data-field="bs_monthlyRevenue" placeholder="e.g. $100,000"></div>
          <div class="field-group"><label>Gross Margin (%)</label><input type="text" data-field="bs_grossMargin" placeholder="e.g. 60"></div>
          <div class="field-group"><label>Net Margin (%)</label><input type="text" data-field="bs_netMargin" placeholder="e.g. 15"></div>
          <div class="field-group"><label>MRR Growth Rate (%)</label><input type="text" data-field="bs_mrrGrowth" placeholder="e.g. 10"></div>
          <div class="field-group"><label>Monthly Burn Rate</label><input type="text" data-field="bs_burnRate" placeholder="e.g. $50,000"></div>
          <div class="field-group"><label>Runway (months)</label><input type="text" data-field="bs_runway" placeholder="e.g. 12"></div>
          <div class="field-group"><label>Current Yearly Profit</label><input type="text" data-field="bs_yearlyProfit" placeholder="e.g. $250,000"></div>
          <div class="field-group"><label>Product / Service Lines</label><textarea data-field="bs_productLines" placeholder="List all products or service tiers"></textarea></div>
        </div>
      </div></div>
    </div>

    <div class="accordion" id="accGrowth">
      <div class="accordion-header" onclick="toggleAccordion('accGrowth')">
        <span class="accordion-title">Growth & Planning</span>
        <span class="accordion-count">7 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>12-Month Revenue Goal</label><input type="text" data-field="bs_revenueGoal" placeholder="e.g. $5,000,000"></div>
          <div class="field-group"><label>Main Growth Channel</label><input type="text" data-field="bs_mainGrowthChannel" placeholder="e.g. Paid search, content, partnerships"></div>
          <div class="field-group"><label>Growth Strategy</label><textarea data-field="bs_growthStrategy" placeholder="e.g. Increase LTV via add-ons, expand to new markets"></textarea></div>
          <div class="field-group"><label>Growth Constraints</label><textarea data-field="bs_growthConstraints" placeholder="e.g. Hiring, tech, capital, market awareness"></textarea></div>
          <div class="field-group"><label>Funding Needed</label><input type="text" data-field="bs_fundingNeeded" placeholder="e.g. $1,000,000"></div>
          <div class="field-group"><label>Exit Timeline</label><input type="text" data-field="bs_exitTimeline" placeholder="e.g. Q4 2028"></div>
          <div class="field-group"><label>Exit Target Amount</label><input type="text" data-field="bs_exitTarget" placeholder="e.g. $75,000,000"></div>
        </div>
      </div></div>
    </div>

    <div class="accordion" id="accOps">
      <div class="accordion-header" onclick="toggleAccordion('accOps')">
        <span class="accordion-title">Operations & Delivery</span>
        <span class="accordion-count">8 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>Customer Acquisition Process</label><textarea data-field="bs_custAcquisition" placeholder="How do customers currently find and buy?"></textarea></div>
          <div class="field-group"><label>Customer Onboarding</label><textarea data-field="bs_custOnboarding" placeholder="What happens after they sign up?"></textarea></div>
          <div class="field-group"><label>Service Delivery Model</label><textarea data-field="bs_serviceDelivery" placeholder="How is the product/service delivered?"></textarea></div>
          <div class="field-group"><label>Team Structure</label><textarea data-field="bs_teamStructureOps" placeholder="e.g. Marketing (3), Sales (2), Ops (5)"></textarea></div>
          <div class="field-group"><label>Workflow Stages</label><textarea data-field="bs_workflowStages" placeholder="Key stages in your delivery pipeline"></textarea></div>
          <div class="field-group"><label>Quality Metrics</label><textarea data-field="bs_qualityMetrics" placeholder="How do you measure delivery quality?"></textarea></div>
          <div class="field-group"><label>Data & Analytics</label><textarea data-field="bs_dataAnalytics" placeholder="e.g. GA4, Looker dashboards, custom SQL"></textarea></div>
          <div class="field-group"><label>Scheduling / Capacity</label><textarea data-field="bs_scheduling" placeholder="Scheduling rules, capacity constraints"></textarea></div>
        </div>
      </div></div>
    </div>

    <div class="accordion" id="accTechStack">
      <div class="accordion-header" onclick="toggleAccordion('accTechStack')">
        <span class="accordion-title">Tech Stack</span>
        <span class="accordion-count">5 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>Financial & Accounting Tools</label><input type="text" data-field="bs_toolsFinance" placeholder="e.g. QuickBooks, Xero, NetSuite"></div>
          <div class="field-group"><label>Customer & Analytics Tools</label><input type="text" data-field="bs_toolsAnalytics" placeholder="e.g. HubSpot, GA4, Mixpanel"></div>
          <div class="field-group"><label>Sales Tools</label><input type="text" data-field="bs_toolsSales" placeholder="e.g. Salesforce, Pipedrive, Close"></div>
          <div class="field-group"><label>Marketing Tools</label><input type="text" data-field="bs_toolsMarketing" placeholder="e.g. Meta Ads, Mailchimp, SEMrush"></div>
          <div class="field-group"><label>Other Platforms</label><input type="text" data-field="bs_toolsOther" placeholder="e.g. Slack, Notion, ClickUp, Zapier"></div>
        </div>
      </div></div>
    </div>

    <div class="accordion" id="accBrand">
      <div class="accordion-header" onclick="toggleAccordion('accBrand')">
        <span class="accordion-title">Brand & Compliance</span>
        <span class="accordion-count">5 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>Brand Voice / Tone</label><textarea data-field="bs_brandVoice" placeholder="How should your brand sound? e.g. Professional but approachable, no jargon"></textarea></div>
          <div class="field-group"><label>Prohibited Terms</label><textarea data-field="bs_prohibitedTerms" placeholder="Words or phrases to never use in marketing"></textarea></div>
          <div class="field-group"><label>Trust Signals / Social Proof</label><textarea data-field="bs_trustSignals" placeholder="e.g. 200+ clients served, Featured in Forbes, SOC2 certified"></textarea></div>
          <div class="field-group"><label>Licenses / Certifications</label><textarea data-field="bs_licenses" placeholder="Professional licenses, industry certifications"></textarea></div>
          <div class="field-group"><label>Ad Restrictions</label><textarea data-field="bs_adRestrictions" placeholder="Any advertising limitations (industry, platform, regulatory)"></textarea></div>
        </div>
      </div></div>
    </div>

    <div class="accordion" id="accOfferArch">
      <div class="accordion-header" onclick="toggleAccordion('accOfferArch')">
        <span class="accordion-title">Offer Architecture</span>
        <span class="accordion-count">4 fields</span>
        <span class="accordion-arrow">&#9656;</span>
      </div>
      <div class="accordion-body"><div class="accordion-body-inner">
        <div class="field-grid">
          <div class="field-group"><label>Differentiators</label><textarea data-field="bs_differentiators" placeholder="What makes you different from every competitor?"></textarea></div>
          <div class="field-group"><label>Proof Assets</label><textarea data-field="bs_proofAssets" placeholder="Case studies, testimonials, data, awards you can reference"></textarea></div>
          <div class="field-group"><label>Offer Packages / Tiers</label><textarea data-field="bs_offerPackages" placeholder="List your pricing tiers, packages, or service levels"></textarea></div>
          <div class="field-group"><label>Promotions / Lead Magnets</label><textarea data-field="bs_promotions" placeholder="Current offers, free resources, trials, audits"></textarea></div>
        </div>
      </div></div>
    </div>
  </div>
</section>

<!-- S1: DREAM CLIENT PROFILE -->
<section id="s1" class="workshop-section">
  <div class="section-banner">Your Dream Client Profile</div>
  <div class="section-body">
    <p class="section-intro">Define exactly who your ideal client is. The more precise your ICP, the more effective your campaigns and the easier your sales conversations.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Facilitator Guide</div><div class="tip-content"><ul><li>Push for specifics. "Tech companies" is too broad. "Series A-C SaaS in fintech, 10-50 employees" is actionable.</li><li>Ask: "If you could clone your 3 best clients, who and why?"</li><li>For each answer, probe: "What makes them better than other clients in the same category?"</li></ul></div></div>
    <div class="field-group"><label>1. Geography</label><span class="field-sublabel">Countries, regions. Note differences in buying behavior by location.</span><textarea data-field="dc_geography" placeholder="e.g. UK, USA, Europe. Note: USA closes faster..."></textarea></div>
    <div class="field-group"><label>2. Industry / Verticals</label><span class="field-sublabel">Be specific. List sub-sectors, not just "tech."</span><textarea data-field="dc_industry" placeholder="e.g. SaaS, Fintech, hardware-enabled tech, AI/ML startups..."></textarea></div>
    <div class="field-group"><label>3. Company Size & Revenue</label><span class="field-sublabel">Employee count range, revenue range, and the sweet spot.</span><textarea data-field="dc_companySize" placeholder="e.g. 10-200 employees. Sweet spot: 10-30. Revenue: $500K-$20M ARR..."></textarea></div>
    <div class="field-group"><label>4. Funding Stage / Business Maturity</label><span class="field-sublabel">Bootstrapped? Seed? Series A-C?</span><textarea data-field="dc_fundingStage" placeholder="e.g. Series A-C. First or second time founders..."></textarea></div>
    <div class="field-group"><label>5. Job Titles / Decision Makers</label><span class="field-sublabel">Who do you sell to? Who signs? Who champions internally?</span><textarea data-field="dc_jobTitles" placeholder="e.g. CEO/Founder (smaller companies), CFO/COO (larger)..."></textarea></div>
    <div class="field-group"><label>6. Buyer Personality & Traits</label><span class="field-sublabel">What personality traits define your best clients?</span><textarea data-field="dc_personality" placeholder="e.g. Diligent, direct communicator, humble, understands finance..."></textarea></div>
    <div class="field-group"><label>7. Tech Stack / Tools They Use</label><span class="field-sublabel">What software or platforms do your ideal clients use?</span><textarea data-field="dc_techStack" placeholder="e.g. Xero/QuickBooks, Notion, Slack, pitch decks in Canva..."></textarea></div>
    <div class="field-group"><label>8. Revenue Range</label><span class="field-sublabel">Annual revenue range of ideal clients.</span><textarea data-field="dc_revenue" placeholder="e.g. $500K-$20M ARR. Pre-revenue if funded. Sweet spot: $1-5M."></textarea></div>
    <div class="field-group"><label>9. Growth Signals</label><span class="field-sublabel">Observable signs they're a good fit right now.</span><textarea data-field="dc_growthSignals" placeholder="e.g. Recently hired, posting jobs, new product launch, press mentions, funding announcement..."></textarea></div>
    <div class="field-group"><label>10. Team Structure</label><span class="field-sublabel">Do they have internal resources that overlap or complement your service?</span><textarea data-field="dc_teamStructure" placeholder="e.g. No in-house finance team, maybe a part-time bookkeeper. No FP&A capability."></textarea></div>
    <div class="field-group"><label>11. Your Best Current Clients</label><span class="field-sublabel">3-5 clients you would clone. For each, WHY are they great?</span><textarea data-field="dc_bestClients" placeholder="e.g. Mindsite - no BS, direct. HelloKlean - clean data..."></textarea></div>
    <div class="field-group"><label>12. Dream Clients</label><span class="field-sublabel">If you could land any company, who and why?</span><textarea data-field="dc_dreamClients" placeholder="e.g. Canva, Remarkable, UI Path..."></textarea></div>
  </div>
</section>

<!-- S2: WHAT DRIVES THEM -->
<section id="s2" class="workshop-section">
  <div class="section-banner">Psychographic Depth</div>
  <div class="section-body">
    <p class="section-intro">Understand the emotional landscape - goals, fears, frustrations, identity, and decision-making patterns. This becomes the foundation of all messaging.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Facilitator Guide</div><div class="tip-content"><ul><li>Push beyond surface. "They want to grow" is not enough. Ask: "What does growth mean specifically?"</li><li>For each problem: "What happens if this goes unsolved for 6 more months?"</li><li>The #1 pain point becomes your primary marketing message.</li></ul></div></div>
    <div class="field-group"><label>1. Business Goals & Desires</label><span class="field-sublabel">Daily, short-term, medium-term, long-term.</span><textarea data-field="wd_businessGoals" placeholder="Long-term: Exit/IPO. Short-term: Revenue growth..."></textarea></div>
    <div class="field-group"><label>2. Personal Dreams & Desires</label><span class="field-sublabel">Beyond business - what motivates them as a person?</span><textarea data-field="wd_personalDreams" placeholder="e.g. Be respected by peers, make family proud..."></textarea></div>
    <div class="field-group"><label>3. Problems They Face</label><span class="field-sublabel">Every problem your service solves. Be specific about symptoms.</span><textarea data-field="wd_problems" placeholder="e.g. Can't meet investor requirements, presenting wrong data..."></textarea></div>
    <div class="field-group"><label>Pain Severity (1 = annoyance, 10 = existential)</label><div class="slider-row"><input type="range" min="1" max="10" value="7" data-field="wd_painSeverity" oninput="this.nextElementSibling.textContent=this.value; debouncedSave();"><span class="slider-value">7</span></div><div class="slider-labels"><span>Minor</span><span>Critical</span></div></div>
    <div class="field-group"><label>Quantify the Impact</label><span class="field-sublabel">What does this cost them? Money, time, opportunities.</span><textarea data-field="wd_painCost" placeholder="e.g. Failed fundraise = 6 months wasted, $50K legal fees..."></textarea></div>
    <div class="field-group"><label>4. Fears</label><span class="field-sublabel">Worst-case scenarios they imagine.</span><textarea data-field="wd_fears" placeholder="e.g. Not getting funding, running out of money, going back to a job..."></textarea></div>
    <div class="field-group"><label>5. Suspicions</label><span class="field-sublabel">What are they skeptical about?</span><textarea data-field="wd_suspicions" placeholder="e.g. Remote team accessibility, pricing confusion..."></textarea></div>
    <div class="field-group"><label>6. Enemies</label><span class="field-sublabel">Internal (habits, mindset) and external (competitors, market).</span><textarea data-field="wd_enemies" placeholder="e.g. Complacency, 'we'll figure it out' mentality..."></textarea></div>
    <div class="field-group"><label>7. Trends & Market Environment</label><textarea data-field="wd_trends" placeholder="e.g. Tighter VC funding, higher due diligence bar..."></textarea></div>
    <hr class="section-divider">
    <div class="field-group"><label>8. Identity Story</label><span class="field-sublabel">How do they see themselves? What role do they play in their own narrative?</span><textarea data-field="wd_identityStory" placeholder="e.g. They see themselves as builders/innovators disrupting an industry. They identify as visionary founders, not finance people."></textarea></div>
    <div class="field-group"><label>9. Status Signals</label><span class="field-sublabel">What signals status and success in their world?</span><textarea data-field="wd_statusSignals" placeholder="e.g. TechCrunch features, big-name investors on cap table, speaking at SaaStr, team size milestones, ARR milestones..."></textarea></div>
    <div class="field-group"><label>10. Communities & Peer Groups</label><span class="field-sublabel">Where do they gather? Who do they trust?</span><textarea data-field="wd_communityBehavior" placeholder="e.g. YC alumni, Founders Network, LinkedIn founder groups, Slack communities, mastermind groups..."></textarea></div>
    <div class="field-group"><label>11. Content Consumption</label><span class="field-sublabel">What content do they consume and trust?</span><textarea data-field="wd_contentPreferences" placeholder="e.g. Read TechCrunch/Sifted, listen to 20VC podcast, follow VCs on Twitter, prefer short-form video..."></textarea></div>
    <div class="field-group"><label>12. Decision-Making Framework</label><span class="field-sublabel">How do they evaluate and decide? Logic vs. gut? Committee vs. solo?</span><textarea data-field="wd_decisionFramework" placeholder="e.g. Founder decides solo for <$5K. Seeks advisor/peer validation for bigger commitments. Trusts referrals over cold outreach."></textarea></div>
  </div>
</section>

<!-- sRI: REVENUE INTELLIGENCE -->
<section id="sRI" class="workshop-section">
  <div class="section-banner">Revenue Intelligence</div>
  <div class="section-body">
    <p class="section-intro">Understand the financial dynamics of your buyer - budget authority, purchase patterns, and the economics of their decision.</p>
    <div class="field-row">
      <div class="field-group"><label>Budget Range</label><span class="field-sublabel">What do they typically spend on services like yours?</span><textarea data-field="ri_budget" placeholder="e.g. $2K-10K/month. Annual budget authority usually $20-100K."></textarea></div>
      <div class="field-group"><label>Purchase Cycle</label><span class="field-sublabel">How long from problem awareness to purchase?</span><textarea data-field="ri_purchaseCycle" placeholder="e.g. 2-6 weeks. Faster when fundraising is imminent."></textarea></div>
    </div>
    <div class="field-group"><label>Procurement Process</label><span class="field-sublabel">How do they buy? PO required? Legal review? Board approval?</span><textarea data-field="ri_procurementProcess" placeholder="e.g. Founder signs directly for <$5K. Board involvement for annual commitments."></textarea></div>
    <div class="field-group"><label>Payment Preferences</label><textarea data-field="ri_paymentPreferences" placeholder="e.g. Monthly retainer preferred. Card or wire. Net-30 for larger companies."></textarea></div>
    <div class="field-row">
      <div class="field-group"><label>Expected Client LTV</label><textarea data-field="ri_lifetimeValue" placeholder="e.g. $36K-72K over 12-24 month engagement"></textarea></div>
      <div class="field-group"><label>ROI Expectations</label><textarea data-field="ri_roiExpectation" placeholder="e.g. 5-10x ROI. Expect to see first results in 30 days."></textarea></div>
    </div>
    <div class="field-group"><label>Cost of Inaction</label><span class="field-sublabel">What does it cost them to NOT solve this problem?</span><textarea data-field="ri_costOfInaction" placeholder="e.g. 10-30% valuation haircut = $500K-$3M lost. 6+ month fundraising delay."></textarea></div>
    <div class="field-group"><label>Competing Budget Priorities</label><span class="field-sublabel">What else competes for the same budget?</span><textarea data-field="ri_competingBudgets" placeholder="e.g. Sales tools, hiring, product development. Finance is often last priority."></textarea></div>
    <div class="field-group"><label>Price Sensitivity (1 = very sensitive, 10 = price is irrelevant)</label><div class="slider-row"><input type="range" min="1" max="10" value="6" data-field="ri_priceSensitivity" oninput="this.nextElementSibling.textContent=this.value; debouncedSave();"><span class="slider-value">6</span></div><div class="slider-labels"><span>Very Sensitive</span><span>Price Irrelevant</span></div></div>
  </div>
</section>

<!-- sCM: CHANNEL & MEDIA -->
<section id="sCM" class="workshop-section">
  <div class="section-banner">Channel & Media Preferences</div>
  <div class="section-body">
    <p class="section-intro">Where does your dream client spend their time? What do they consume? This determines your outreach strategy.</p>
    <div class="field-group"><label>Social Platforms They Use</label><span class="field-sublabel">Where are they most active? Rank by importance.</span><textarea data-field="cm_socialPlatforms" placeholder="e.g. LinkedIn (#1 - daily), Twitter/X (#2 - weekly), maybe Instagram for personal. Rarely Facebook."></textarea></div>
    <div class="field-group"><label>Content Formats They Prefer</label><textarea data-field="cm_contentFormats" placeholder="e.g. Short LinkedIn posts, podcast interviews, case study PDFs, short video (under 3 min)..."></textarea></div>
    <div class="field-row">
      <div class="field-group"><label>Events & Conferences</label><textarea data-field="cm_events" placeholder="e.g. SaaStr, Web Summit, local startup meetups, VC demo days..."></textarea></div>
      <div class="field-group"><label>Online Communities</label><textarea data-field="cm_communities" placeholder="e.g. YC founder Slack, Indie Hackers, Reddit r/startups, private Discords..."></textarea></div>
    </div>
    <div class="field-row">
      <div class="field-group"><label>Publications They Read</label><textarea data-field="cm_publications" placeholder="e.g. TechCrunch, Sifted, The Information, SaaStr blog..."></textarea></div>
      <div class="field-group"><label>Podcasts They Listen To</label><textarea data-field="cm_podcasts" placeholder="e.g. 20VC, All-In, My First Million, How I Built This..."></textarea></div>
    </div>
    <div class="field-group"><label>Thought Leaders They Follow</label><textarea data-field="cm_influencers" placeholder="e.g. Jason Lemkin, Tomasz Tunguz, David Sacks, specific VCs in their space..."></textarea></div>
    <div class="field-group"><label>How They Search for Solutions</label><span class="field-sublabel">When they have this problem, where do they look?</span><textarea data-field="cm_searchBehavior" placeholder="e.g. Ask their VC, ask other founders on Slack, Google 'fractional CFO startup', check G2/Clutch..."></textarea></div>
    <div class="field-group"><label>Referral Sources</label><span class="field-sublabel">Who refers clients to you? Where do warm leads come from?</span><textarea data-field="cm_referralSources" placeholder="e.g. VCs, law firms (startup lawyers), accelerator program managers, other founders..."></textarea></div>
    <div class="field-group"><label>Best Outreach Channels</label><span class="field-sublabel">What channels have the highest response rate?</span><textarea data-field="cm_outreachChannels" placeholder="e.g. Warm intro from VC = 80% response. LinkedIn DM = 15%. Cold email = 5%. Podcast invite = 60%."></textarea></div>
  </div>
</section>

<!-- sLM: LANGUAGE & MESSAGING DNA -->
<section id="sLM" class="workshop-section">
  <div class="section-banner">Language & Messaging DNA</div>
  <div class="section-body">
    <p class="section-intro">The exact words your buyer uses determine whether your message resonates or gets ignored. Map their language patterns.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Facilitator Guide</div><div class="tip-content"><ul><li>Mine sales call transcripts, emails, and reviews for exact phrases.</li><li>The goal is to use THEIR words, not yours.</li><li>"Mirror language" converts 2-3x better than industry jargon.</li></ul></div></div>
    <div class="field-group"><label>Industry Jargon / Buzzwords They Use</label><span class="field-sublabel">Exact words and phrases from their world.</span><textarea data-field="lm_jargon" placeholder="e.g. 'runway', 'burn rate', 'cap table', 'data room', 'due diligence', 'Series A ready'..."></textarea></div>
    <div class="field-group"><label>Words / Phrases to AVOID</label><span class="field-sublabel">What turns them off? What sounds salesy or generic?</span><textarea data-field="lm_wordsAvoid" placeholder="e.g. 'synergy', 'leverage', 'best-in-class'. Avoid accounting jargon they don't understand."></textarea></div>
    <div class="field-group"><label>Communication Tone Preference</label><textarea data-field="lm_tonePreference" placeholder="e.g. Direct and no-BS. Casual but competent. They hate corporate speak. Prefer Slack/WhatsApp over formal email."></textarea></div>
    <div class="field-group"><label>How They Describe Their Pain</label><span class="field-sublabel">Exact quotes from sales calls, reviews, or emails.</span><textarea data-field="lm_painLanguage" placeholder='e.g. "Our numbers are a mess", "We got caught with our pants down in DD", "I have no idea if we are profitable"'></textarea></div>
    <div class="field-group"><label>How They Describe Success</label><span class="field-sublabel">What does "winning" sound like in their words?</span><textarea data-field="lm_aspirationLanguage" placeholder='e.g. "Investor-ready", "clean books", "we closed the round", "sailed through due diligence"'></textarea></div>
    <div class="field-group"><label>How They Voice Objections</label><span class="field-sublabel">The way they push back - their actual words.</span><textarea data-field="lm_objectionLanguage" placeholder='e.g. "We already have an accountant", "Can we just do it ourselves?", "Is this really urgent right now?"'></textarea></div>
    <div class="field-group"><label>Proof They Trust Most</label><span class="field-sublabel">What type of evidence convinces them?</span><textarea data-field="lm_socialProofType" placeholder="e.g. Case studies from similar-stage startups. Named logos they recognize. Referrals from their VC."></textarea></div>
    <div class="field-row">
      <div class="field-group"><label>Messaging DOs</label><textarea data-field="lm_messagingDOs" placeholder="e.g. Lead with outcomes, use numbers, reference their stage, keep it short..."></textarea></div>
      <div class="field-group"><label>Messaging DON'Ts</label><textarea data-field="lm_messagingDONTs" placeholder="e.g. Don't lead with features, don't use finance jargon, don't compare to accountants..."></textarea></div>
    </div>
  </div>
</section>

<!-- S3: TRIGGER EVENTS -->
<section id="s3" class="workshop-section">
  <div class="section-banner">Trigger Events</div>
  <div class="section-body">
    <p class="section-intro">What causes a prospect to start looking NOW? Sellers who contact first after a trigger are 5x more likely to win.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Facilitator Guide</div><div class="tip-content"><ul><li>Ask: "Think about your last 5 clients. What event made them reach out?"</li><li>The best triggers have built-in urgency (deadline, money running out, board meeting).</li></ul></div></div>
    <div class="field-group"><label>Check all triggers that apply:</label></div>
    <div class="trigger-grid">
      <label class="trigger-card"><input type="checkbox" data-field="trig_newFunding"><span>New funding round</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_preparing"><span>Preparing to fundraise</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_boardPressure"><span>Board / investor pressure</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_runway"><span>Runway getting short</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_failedAudit"><span>Failed audit / due diligence</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_newCxo"><span>New CFO / COO hire</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_rapidGrowth"><span>Rapid growth / scaling</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_regulation"><span>Regulatory requirement</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_competitor"><span>Competitor raised / acquired</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_badQuarter"><span>Bad financial results</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_leaderChange"><span>Leadership change</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_mAndA"><span>M&A activity</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_expansion"><span>International expansion</span></label>
      <label class="trigger-card"><input type="checkbox" data-field="trig_firedProvider"><span>Fired existing provider</span></label>
    </div>
    <div class="field-group" style="margin-top:18px"><label>Top 3 Triggers</label><textarea data-field="trig_top3" placeholder="1. Preparing to raise and financials are a mess\n2. Investor due diligence coming, not ready\n3. Board asking for reports they can't produce"></textarea></div>
    <div class="field-group"><label>Custom Triggers</label><textarea data-field="trig_custom" placeholder="Any other events unique to your market..."></textarea></div>
    <hr class="section-divider">
    <div class="field-row">
      <div class="field-group"><label>Seasonal Patterns</label><span class="field-sublabel">When do they buy? Q1 budgets? Year-end urgency?</span><textarea data-field="trig_seasonality" placeholder="e.g. Q4 rush before year-end. Q1 new budget cycles. Fundraising peaks in Sept-Nov, Feb-Apr."></textarea></div>
      <div class="field-group"><label>Budget Cycles</label><span class="field-sublabel">When do budgets get approved or refreshed?</span><textarea data-field="trig_budgetCycles" placeholder="e.g. Startups: post-funding. Enterprise: Q4/Q1 planning. Rolling for monthly retainers."></textarea></div>
    </div>
    <div class="field-group"><label>Digital Intent Signals</label><span class="field-sublabel">Online behaviors that indicate buying intent. Useful for targeted ads and outreach timing.</span><textarea data-field="trig_digitalSignals" placeholder="e.g. Googling 'fractional CFO', downloading fundraising guides, posting about hiring finance roles, visiting competitor pages, job postings for finance roles..."></textarea></div>
    <div class="field-group"><label>Urgency Drivers</label><span class="field-sublabel">What creates time pressure to act NOW vs. later?</span><textarea data-field="trig_urgencyDrivers" placeholder="e.g. Investor deadline in 6 weeks, board meeting next month, runway under 6 months, term sheet on the table..."></textarea></div>
    <div class="field-group"><label>Ideal Outreach Timing</label><span class="field-sublabel">When is the best moment to reach them?</span><textarea data-field="trig_idealTiming" placeholder="e.g. 2-3 months before planned fundraise. Right after funding announcement. After failed DD."></textarea></div>
  </div>
</section>

<!-- S4: BUYING COMMITTEE -->
<section id="s4" class="workshop-section">
  <div class="section-banner">Buying Committee</div>
  <div class="section-body">
    <p class="section-intro">The average B2B deal involves 6-10 stakeholders. Map who is involved and what each person cares about.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Facilitator Guide</div><div class="tip-content"><ul><li>"Walk me through the last deal you closed. Who was involved?"</li><li>For each role: "What question did they ask? What almost killed the deal?"</li></ul></div></div>
    <div class="role-grid">
      <div class="role-card"><h4>Decision Maker</h4><div class="role-desc">Signs the contract. Final authority.</div><div class="field-group"><label>Title</label><input type="text" data-field="bc_dm_title" placeholder="e.g. CEO, Founder"></div><div class="field-group"><label>What they care about</label><textarea data-field="bc_dm_concern" placeholder="e.g. ROI, risk, speed"></textarea></div><div class="field-group"><label>Likely objection</label><textarea data-field="bc_dm_objection" placeholder="e.g. Why can't our accountant do this?"></textarea></div></div>
      <div class="role-card"><h4>Internal Champion</h4><div class="role-desc">Your advocate. Sells when you're not in the room.</div><div class="field-group"><label>Title</label><input type="text" data-field="bc_ch_title" placeholder="e.g. Head of Finance"></div><div class="field-group"><label>What they care about</label><textarea data-field="bc_ch_concern" placeholder="e.g. Making their life easier"></textarea></div><div class="field-group"><label>Content they need</label><textarea data-field="bc_ch_content" placeholder="e.g. Case studies, one-pager"></textarea></div></div>
      <div class="role-card"><h4>Budget Holder</h4><div class="role-desc">Controls the money.</div><div class="field-group"><label>Title</label><input type="text" data-field="bc_bh_title" placeholder="e.g. CFO, CEO"></div><div class="field-group"><label>Approval threshold</label><textarea data-field="bc_bh_threshold" placeholder="e.g. Under $5K = no approval needed"></textarea></div><div class="field-group"><label>ROI they need</label><textarea data-field="bc_bh_roi" placeholder="e.g. Save 10+ hrs/month"></textarea></div></div>
      <div class="role-card"><h4>Technical Evaluator</h4><div class="role-desc">Assesses fit and feasibility.</div><div class="field-group"><label>Title</label><input type="text" data-field="bc_te_title" placeholder="e.g. Head of Ops"></div><div class="field-group"><label>What they assess</label><textarea data-field="bc_te_concern" placeholder="e.g. Integration, security"></textarea></div><div class="field-group"><label>Blocker</label><textarea data-field="bc_te_blocker" placeholder="e.g. Already have an accountant"></textarea></div></div>
      <div class="role-card"><h4>End User</h4><div class="role-desc">Interacts with your service daily.</div><div class="field-group"><label>Title</label><input type="text" data-field="bc_eu_title" placeholder="e.g. Founder, Ops Manager"></div><div class="field-group"><label>Concerns</label><textarea data-field="bc_eu_concern" placeholder="e.g. How much of my time?"></textarea></div></div>
      <div class="role-card"><h4>Potential Blocker</h4><div class="role-desc">May slow or kill the deal.</div><div class="field-group"><label>Title</label><input type="text" data-field="bc_bl_title" placeholder="e.g. Board member, legal"></div><div class="field-group"><label>Why they block</label><textarea data-field="bc_bl_concern" placeholder="e.g. Switching costs"></textarea></div><div class="field-group"><label>How to address</label><textarea data-field="bc_bl_address" placeholder="e.g. Show scope comparison"></textarea></div></div>
    </div>
    <div class="field-group" style="margin-top:18px"><label>Typical Buying Process</label><span class="field-sublabel">Sales cycle length, steps, who enters when.</span><textarea data-field="bc_process" placeholder="e.g. 2-4 weeks. Discovery > Proposal > Internal discussion > Signed"></textarea></div>
    <div class="field-group"><label>External Influencers</label><span class="field-sublabel">People outside the org who influence the decision.</span><textarea data-field="bc_influenceMap" placeholder="e.g. VCs (often recommend solutions), startup lawyers, fellow founders, advisors..."></textarea></div>
    <div class="field-group"><label>Common Deal Killers</label><span class="field-sublabel">What most often kills deals that should have closed?</span><textarea data-field="bc_dealKillers" placeholder="e.g. Founder gets busy and ghosts. Board says wait. They try DIY first. Lost urgency after fundraise delayed."></textarea></div>
  </div>
</section>

<!-- sBB: BUYING BEHAVIOR -->
<section id="sBB" class="workshop-section">
  <div class="section-banner">Buying Behavior Patterns</div>
  <div class="section-body">
    <p class="section-intro">How your buyers evaluate, compare, and ultimately choose. Understanding this shapes your entire sales process.</p>
    <div class="field-group"><label>Evaluation Criteria</label><span class="field-sublabel">What factors matter most when they compare options? Rank them.</span><textarea data-field="bb_evaluationCriteria" placeholder="1. Industry expertise (do they know startups?)\n2. Speed to first deliverable\n3. Price vs. value\n4. Team personality fit\n5. References from similar companies"></textarea></div>
    <div class="field-group"><label>How They Compare Vendors</label><span class="field-sublabel">Do they create shortlists? Use RFPs? Ask for referrals?</span><textarea data-field="bb_vendorComparison" placeholder="e.g. Usually compare 2-3 options. Ask VC for recommendation. Google search + LinkedIn. Rarely formal RFP."></textarea></div>
    <div class="field-group"><label>Proof / Evidence Required</label><span class="field-sublabel">What do they need to see before saying yes?</span><textarea data-field="bb_proofRequired" placeholder="e.g. Case study from similar-stage startup. Named reference they can call. Sample report or deliverable."></textarea></div>
    <div class="field-group"><label>Free Trial / Pilot Expectations</label><textarea data-field="bb_trialExpectation" placeholder="e.g. Some expect a free audit or assessment first. Others just want to see a sample report."></textarea></div>
    <div class="field-row">
      <div class="field-group"><label>Contract Preferences</label><textarea data-field="bb_contractPreference" placeholder="e.g. Monthly preferred. 3-month minimum OK if results shown early."></textarea></div>
      <div class="field-group"><label>Selection Timeline</label><textarea data-field="bb_selectionTimeline" placeholder="e.g. 1-2 weeks from first call to signed. Faster if fundraise is imminent."></textarea></div>
    </div>
    <div class="field-group"><label>Implementation Concerns</label><span class="field-sublabel">What worries them about getting started?</span><textarea data-field="bb_implementationConcerns" placeholder="e.g. Time commitment from founder (data gathering), security of financial data, onboarding disruption..."></textarea></div>
    <div class="field-group"><label>How They Measure Your Success</label><span class="field-sublabel">What KPIs or outcomes will they judge you on?</span><textarea data-field="bb_successMetrics" placeholder="e.g. Clean data room in 30 days. Monthly reports on time. Investor feedback on financials. Successful DD."></textarea></div>
    <div class="field-group"><label>Switching Barriers from Current Solution</label><span class="field-sublabel">What keeps them stuck with the status quo?</span><textarea data-field="bb_switchingBarriers" placeholder="e.g. Already paying accountant. Migration effort. 'Good enough' mentality. Fear of change during fundraise."></textarea></div>
  </div>
</section>

<!-- S6: CASE STUDIES -->
<section id="s6" class="workshop-section">
  <div class="section-banner">Case Study Transformations</div>
  <div class="section-body">
    <p class="section-intro">Focus on quantifiable results, not features. These become your proof points.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Tips & Examples</div><div class="tip-content"><ul><li>Quantify: revenue, time saved, % improvement.</li><li>Result, not product: "Passed Series B due diligence in 2 weeks instead of 8."</li><li>Always add a timeframe.</li></ul></div></div>
    <div class="dynamic-list" id="caseStudiesList"></div>
    <button class="add-item-btn" onclick="addListItem('caseStudies')">+ Add Case Study</button>
  </div>
</section>

<!-- S7: BEFORE / AFTER -->
<section id="s7" class="workshop-section">
  <div class="section-banner">Before / After + Process Framework</div>
  <div class="section-body">
    <div class="field-group"><label>BEFORE State</label><span class="field-sublabel">Paint a vivid picture of life before you help them.</span><textarea data-field="ba_before" placeholder="e.g. Unreconciled financials, no reporting standards..."></textarea></div>
    <hr class="section-divider">
    <div class="field-group"><label>The Steps (Your Process)</label><textarea data-field="ba_steps" placeholder="1. Get accounting records\n2. Map into financial model\n3. Founder interviews..."></textarea></div>
    <hr class="section-divider">
    <div class="field-group"><label>AFTER State</label><span class="field-sublabel">Life after your transformation.</span><textarea data-field="ba_after" placeholder="e.g. Fully reconciled accounts, 5-year forecast, investor-ready dashboard..."></textarea></div>
    <hr class="section-divider">
    <div class="field-group"><label>Framework Name</label><span class="field-sublabel">Catchy, memorable name for your process.</span><input type="text" data-field="ba_frameworkName" placeholder="e.g. The Investor-Ready Framework"></div>
    <div class="field-group"><label>Named Steps (max 7)</label><textarea data-field="ba_frameworkSteps" placeholder="1. DISCOVER\n2. MAP\n3. CLARIFY\n4. REPORT\n5. FORECAST\n6. LAUNCH\n7. MAINTAIN"></textarea></div>
    <div class="field-group"><label>Framework Summary</label><textarea data-field="ba_frameworkSummary" placeholder="One clear paragraph for your website or pitch..."></textarea></div>
    <div class="field-group"><label>Timeline</label><textarea data-field="ba_timeline" placeholder="e.g. Onboarding: 4-6 weeks. First report: Week 3..."></textarea></div>
  </div>
</section>

<!-- S8: FEATURES -->
<section id="s8" class="workshop-section">
  <div class="section-banner">Features & Benefits</div>
  <div class="section-body">
    <p class="section-intro">Each feature maps to a process step and has a clear benefit + proof point.</p>
    <div class="dynamic-list" id="featuresList"></div>
    <button class="add-item-btn" onclick="addListItem('features')">+ Add Feature</button>
  </div>
</section>

<!-- S9: GUARANTEE -->
<section id="s9" class="workshop-section">
  <div class="section-banner">Guarantee & Offer Stack</div>
  <div class="section-body">
    <p class="section-intro">A strong guarantee closes 30% more deals. Combined with a value stack, this becomes irresistible.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Tips</div><div class="tip-content"><ul><li>Hormozi Value Equation: Value = (Dream Outcome x Likelihood) / (Time x Effort)</li><li>Increase value by: bigger outcome, higher confidence, faster results, less effort from them.</li></ul></div></div>
    <div class="field-group"><label>Your Guarantee</label><textarea data-field="g_guarantee" placeholder="e.g. If they fail because of us, we work for free for 3 months."></textarea></div>
    <div class="field-group"><label>Unique Mechanism</label><span class="field-sublabel">WHY can you guarantee this?</span><textarea data-field="g_mechanism" placeholder="e.g. We are all former auditors..."></textarea></div>
    <div class="field-group"><label>Risk Reversal</label><textarea data-field="g_riskReversal" placeholder="e.g. Month-to-month, first report in 3 weeks..."></textarea></div>
    <div class="field-group"><label>Value Stack</label><span class="field-sublabel">Everything the client gets. Core offer + bonuses.</span><textarea data-field="g_valueStack" placeholder="Core: Monthly reporting\nBonus 1: Data room setup\nBonus 2: Investor deck review..."></textarea></div>
    <div class="field-group"><label>Dream Outcome (one sentence)</label><textarea data-field="g_dreamOutcome" placeholder="e.g. Pass due diligence with confidence and add 30% to your valuation."></textarea></div>
  </div>
</section>

<!-- S10: COMPETITIVE -->
<section id="s10" class="workshop-section">
  <div class="section-banner">Competitive Positioning</div>
  <div class="section-body">
    <p class="section-intro">Know who you compete against and why you win. Don't forget "Do Nothing" - often your #1 competitor.</p>
    <div class="dynamic-list" id="competitorsList"></div>
    <button class="add-item-btn" onclick="addListItem('competitors')">+ Add Competitor</button>
    <div class="field-group" style="margin-top:18px"><label>Your #1 Differentiator</label><textarea data-field="cp_differentiator" placeholder="e.g. The only firm with auditor backgrounds exclusively serving tech startups."></textarea></div>
  </div>
</section>

<!-- sSP: SALES PROCESS DESIGN -->
<section id="sSP" class="workshop-section">
  <div class="section-banner">Sales Process Design</div>
  <div class="section-body">
    <p class="section-intro">Map your ideal sales process from first touch to signed contract. This becomes your playbook.</p>
    <div class="field-group"><label>Qualification Criteria (BANT/MEDDIC)</label><span class="field-sublabel">What must be true for a lead to be qualified?</span><textarea data-field="sp_qualificationCriteria" placeholder="Budget: >$2K/mo available\nAuthority: Founder or C-suite\nNeed: Active fundraise or DD coming\nTimeline: Within 3 months"></textarea></div>
    <div class="field-group"><label>Key Discovery Questions</label><span class="field-sublabel">The 5-7 questions you MUST ask in every discovery call.</span><textarea data-field="sp_discoveryQuestions" placeholder="1. When are you planning to raise?\n2. What does your current finance setup look like?\n3. Have you been through DD before?\n4. What happened last time?\n5. What would investor-ready look like for you?"></textarea></div>
    <div class="field-group"><label>Demo / Presentation Strategy</label><span class="field-sublabel">What do you show them? In what order?</span><textarea data-field="sp_demoStrategy" placeholder="e.g. Show sample report first (wow factor). Then walk through case study. Then discuss their specific situation."></textarea></div>
    <div class="field-group"><label>Proposal Structure</label><textarea data-field="sp_proposalStructure" placeholder="e.g. 1-page scope. Before/After visual. 3 pricing tiers. Timeline. Guarantee. Case study. Start date."></textarea></div>
    <div class="field-group"><label>Closing Strategies</label><span class="field-sublabel">What works to get them to sign?</span><textarea data-field="sp_closingTechniques" placeholder="e.g. Urgency from fundraise timeline. Limited capacity (only take 3 new clients/month). Founder referral."></textarea></div>
    <div class="field-group"><label>Follow-Up Cadence</label><span class="field-sublabel">What happens after the call if they don't sign immediately?</span><textarea data-field="sp_followUpCadence" placeholder="Day 1: Send proposal + case study\nDay 3: Follow up email\nDay 7: Value-add content\nDay 14: Check in\nDay 30: Nurture sequence"></textarea></div>
  </div>
</section>

<!-- S5: NEGATIVE PERSONAS -->
<section id="s5" class="workshop-section">
  <div class="section-banner">Negative Personas</div>
  <div class="section-body">
    <p class="section-intro">Bad-fit clients drain resources and damage reputation. Define your disqualifiers.</p>
    <div class="tip-box"><div class="tip-toggle" onclick="this.parentElement.classList.toggle('open')">Facilitator Guide</div><div class="tip-content"><ul><li>"Think about your worst client experiences. What did they have in common?"</li><li>If a lead matches 2+ disqualifiers, they're out.</li></ul></div></div>
    <div class="field-group"><label>Red Flags / Disqualifiers</label><textarea data-field="np_redFlags" placeholder="e.g. No willingness to share data, expect results in 1 week..."></textarea></div>
    <div class="field-group"><label>Past Bad Clients</label><textarea data-field="np_badClients" placeholder="e.g. Client X - refused data, blamed us for delays..."></textarea></div>
    <div class="field-group"><label>Industries to Avoid</label><textarea data-field="np_avoidIndustries" placeholder="e.g. Pre-revenue with no funding, companies with full-time CFO..."></textarea></div>
    <div class="field-group"><label>Warning Phrases</label><span class="field-sublabel">What do prospects say that signals bad fit?</span><textarea data-field="np_warningPhrases" placeholder='e.g. "Can you do our taxes too?", "Our last 3 providers were terrible"'></textarea></div>
    <hr class="section-divider">
    <div class="field-group"><label>Time Waster Signals</label><span class="field-sublabel">How do you spot tire-kickers early?</span><textarea data-field="np_timeWasters" placeholder="e.g. Won't share financials before call. Keeps rescheduling. Asks for free work first. No timeline."></textarea></div>
    <div class="field-group"><label>Culture Mismatches</label><textarea data-field="np_cultureMismatch" placeholder="e.g. Expect 24/7 availability. Micromanage every deliverable. Won't take advice. Blame-culture."></textarea></div>
    <div class="field-group"><label>Flags That CAN Be Overcome</label><span class="field-sublabel">Red flags that seem bad but are actually addressable.</span><textarea data-field="np_overcomableFlags" placeholder="e.g. 'Too expensive' = often just needs ROI education. 'We have an accountant' = different service."></textarea></div>
    <div class="field-group"><label>Who to Refer Out To</label><span class="field-sublabel">When you disqualify, who do you send them to?</span><textarea data-field="np_referOutTo" placeholder="e.g. Pre-revenue  recommend bookkeeping service. Tax issues  accounting firm. Too small  DIY template."></textarea></div>
  </div>
</section>

<!-- sER: EXPANSION & RETENTION -->
<section id="sER" class="workshop-section">
  <div class="section-banner">Expansion & Retention</div>
  <div class="section-body">
    <p class="section-intro">Your best revenue comes from existing clients. Map upsell paths, retention risks, and referral mechanics.</p>
    <div class="field-group"><label>Natural Upsell Paths</label><span class="field-sublabel">What do clients buy after the initial engagement?</span><textarea data-field="er_upsellPaths" placeholder="e.g. Monthly retainer after one-time setup. CFO advisory. Board deck preparation. M&A support."></textarea></div>
    <div class="field-group"><label>Cross-Sell Opportunities</label><textarea data-field="er_crossSell" placeholder="e.g. Tax advisory referral (partner). Legal intro. Pitch deck review. Investor intro service."></textarea></div>
    <div class="field-group"><label>Expansion Signals</label><span class="field-sublabel">What indicates a client is ready for more?</span><textarea data-field="er_expansionSignals" placeholder="e.g. New funding round closed. Entering new market. Hiring spree. Revenue doubling. Board expansion."></textarea></div>
    <div class="field-group"><label>Retention Risk Signals</label><span class="field-sublabel">Early warning signs a client might churn.</span><textarea data-field="er_retentionRisks" placeholder="e.g. Stops responding to reports. Hired full-time CFO. Missed payments. Reduced meeting frequency."></textarea></div>
    <div class="field-row">
      <div class="field-group"><label>Referral Mechanism</label><textarea data-field="er_referralMechanism" placeholder="e.g. Ask after first successful DD. VC introductions. Co-branded case study."></textarea></div>
      <div class="field-group"><label>Common Churn Reasons</label><textarea data-field="er_churnReasons" placeholder="e.g. Hired internal CFO. Ran out of money. Acquired. Felt they outgrew the service."></textarea></div>
    </div>
    <div class="field-group"><label>Client Advocacy</label><span class="field-sublabel">How do you turn clients into advocates?</span><textarea data-field="er_advocacyProgram" placeholder="e.g. Testimonial video after successful raise. LinkedIn recommendation. Referral bonus. Case study co-creation."></textarea></div>
    <div class="field-group"><label>Renewal Process</label><textarea data-field="er_renewalProcess" placeholder="e.g. Month-to-month auto-renew. Quarterly review meeting. Annual price review."></textarea></div>
  </div>
</section>

<!-- S11: HERO STORY -->
<section id="s11" class="workshop-section">
  <div class="section-banner">Hero Story</div>
  <div class="section-body">
    <p class="section-intro">Your origin story makes your company relatable and memorable.</p>
    <table class="hero-table">
      <tr><td>The founder was an expert in the field</td><td><textarea data-field="hs_expert" placeholder="Background..."></textarea></td></tr>
      <tr><td>Founder encountered a problem</td><td><textarea data-field="hs_problem" placeholder="What problem?"></textarea></td></tr>
      <tr><td>Looked everywhere, couldn't find a solution</td><td><textarea data-field="hs_searched" placeholder="What did you try?"></textarea></td></tr>
      <tr><td>Got fed up, tried to solve it alone</td><td><textarea data-field="hs_fedUp" placeholder="Breaking point?"></textarea></td></tr>
      <tr><td>Solution worked better than imagined</td><td><textarea data-field="hs_worked" placeholder="Results?"></textarea></td></tr>
      <tr><td>Everyone else started asking</td><td><textarea data-field="hs_asking" placeholder="Organic demand?"></textarea></td></tr>
      <tr><td>New mission: get solution to the market</td><td><textarea data-field="hs_mission" placeholder="Mission now?"></textarea></td></tr>
    </table>
    <div class="field-group" style="margin-top:18px"><label>Full Narrative</label><textarea data-field="hs_narrative" placeholder="Write the complete founder story..."></textarea></div>
  </div>
</section>

<!-- S12: OBJECTIONS & FAQs -->
<section id="s12" class="workshop-section">
  <div class="section-banner">Objections & FAQs</div>
  <div class="section-body">
    <p class="section-intro">Every objection and FAQ becomes your sales team's playbook.</p>
    <h3 style="font-size:14px;margin-bottom:12px;color:var(--accent-hover)">Common Objections</h3>
    <div class="dynamic-list" id="objectionsList"></div>
    <button class="add-item-btn" onclick="addListItem('objections')">+ Add Objection</button>
    <hr class="section-divider" style="margin:24px 0">
    <h3 style="font-size:14px;margin-bottom:12px;color:var(--accent-hover)">Frequently Asked Questions</h3>
    <div class="dynamic-list" id="faqsList"></div>
    <button class="add-item-btn" onclick="addListItem('faqs')">+ Add FAQ</button>
  </div>
</section>

<!-- S13: MESSAGING MATRIX (Auto-Generated) -->
<section id="s13" class="workshop-section">
  <div class="section-banner">Messaging Matrix <span style="font-size:9px;font-weight:400;letter-spacing:0.5px;opacity:0.7;margin-left:8px">AUTO-GENERATED</span></div>
  <div class="section-body">
    <p class="section-intro">These messages are auto-generated from your workshop answers above. Edit any field to update them in real-time. Copy any card to use in your campaigns.</p>
    <div class="matrix-grid" id="messagingMatrix">
      <div class="matrix-card full-width"><h4>Loading...</h4><p class="empty-hint">Fill in sections above to generate messaging</p></div>
    </div>
    <div class="matrix-copy-all"><button class="hdr-btn" onclick="copyAllMessaging()">Copy All Messaging</button></div>
  </div>
</section>

</main>

<!-- ==================== MODALS ==================== -->
<div class="modal-overlay" id="newWorkshopModal"><div class="modal"><h2>Start New Workshop</h2><p>Saves current data and creates a blank workshop.</p><div class="field-group"><label>New Client Name</label><input type="text" id="newClientInput" placeholder="e.g. Acme Corp" style="background:var(--bg-input);border:1px solid var(--border);color:var(--text-primary);padding:10px 12px;border-radius:6px;width:100%;font-size:14px;"></div><div class="modal-actions"><button class="hdr-btn" onclick="closeModal('newWorkshopModal')">Cancel</button><button class="hdr-btn primary" onclick="createNewWorkshop()">Create</button></div></div></div>
<div class="modal-overlay" id="loadModal"><div class="modal"><h2>Load Previous Workshop</h2><div id="savedClientsList" style="margin-bottom:14px"></div><div class="modal-actions"><button class="hdr-btn" onclick="closeModal('loadModal')">Cancel</button></div></div></div>

<div id="backupReminder"><strong style="color:var(--warning)">Backup Reminder</strong><p style="margin-top:4px">15+ minutes since last backup.</p><div class="reminder-actions"><button class="hdr-btn primary" onclick="backupToDrive();this.parentElement.parentElement.style.display='none'">Backup to Drive</button><button class="hdr-btn" onclick="this.parentElement.parentElement.style.display='none'">Dismiss</button></div></div>

<div id="toastContainer"></div>

<!-- ==================== KEYBOARD SHORTCUT HELP ==================== -->
<div id="helpOverlay" onclick="if(event.target===this)this.classList.remove('open')">
  <div class="help-modal">
    <h2>Keyboard Shortcuts</h2>
    <div class="help-section-title">Navigation</div>
    <div class="help-row"><span class="help-key"><kbd>Ctrl</kbd><kbd>K</kbd></span><span class="help-desc">Search fields</span></div>
    <div class="help-row"><span class="help-key"><kbd>Ctrl</kbd><kbd>S</kbd></span><span class="help-desc">Force save</span></div>
    <div class="help-row"><span class="help-key"><kbd>?</kbd></span><span class="help-desc">Show this help</span></div>
    <div class="help-row"><span class="help-key"><kbd>Esc</kbd></span><span class="help-desc">Close overlay / search</span></div>
    <div class="help-section-title">Sections</div>
    <div class="help-row"><span class="help-desc">Click any section banner to collapse/expand</span></div>
    <div class="help-row"><span class="help-desc">Sidebar dots show section completion</span></div>
    <div class="help-section-title">Data</div>
    <div class="help-row"><span class="help-desc">Auto-saves on every input change</span></div>
    <div class="help-row"><span class="help-desc">IndexedDB snapshot every 60 seconds</span></div>
    <div class="help-row"><span class="help-desc">Drive auto-backup every 5 minutes (when connected)</span></div>
    <div class="help-section-title">Export</div>
    <div class="help-row"><span class="help-desc">PDF Report - full formatted document</span></div>
    <div class="help-row"><span class="help-desc">Markdown - plain text copy</span></div>
    <div class="help-row"><span class="help-desc">JSON Backup - full data for restore</span></div>
    <div style="text-align:center;margin-top:16px"><button class="hdr-btn" onclick="document.getElementById('helpOverlay').classList.remove('open')">Close</button></div>
  </div>
</div>

<!-- ==================== CMD+K SEARCH ==================== -->
<div class="search-overlay" id="searchOverlay" onclick="if(event.target===this)closeSearch()">
  <div class="search-modal">
    <div class="search-input-wrap">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input type="text" class="search-input" id="searchInput" placeholder="Search fields, sections, values..." oninput="performSearch(this.value)">
    </div>
    <div class="search-results" id="searchResults"><div class="search-empty">Type to search across all workshop fields</div></div>
    <div class="search-hint">&#8984;K to open &middot; ESC to close &middot; &#8593;&#8595; to navigate &middot; Enter to jump</div>
  </div>
</div>

<!-- ==================== JAVASCRIPT ==================== -->
<script>
const SAVE_DEBOUNCE = 300;
const SNAPSHOT_INTERVAL = 60000;
const BACKUP_REMINDER_INTERVAL = 900000;
const DB_NAME = 'vpWorkshop';
const DB_VERSION = 1;
const STORE_NAME = 'snapshots';

let state = {};
let saveTimeout = null;
let currentClientKey = '';

// ==================== DYNAMIC LIST DEFS ====================
const listDefs = {
  caseStudies: { container: 'caseStudiesList', fields: [
    { key:'name', label:'Client Name', type:'input', placeholder:'e.g. Mobile Commons' },
    { key:'before', label:'Before', type:'textarea', placeholder:'Their situation before you' },
    { key:'after', label:'After (transformation)', type:'textarea', placeholder:'Result achieved. Include metrics + timeframe.' },
    { key:'metric', label:'Key Metric', type:'input', placeholder:'e.g. Raised $5M in 4 weeks' },
    { key:'notes', label:'Notes', type:'textarea', placeholder:'Testimonial likelihood, relationship...' }
  ], items: [] },
  features: { container: 'featuresList', fields: [
    { key:'step', label:'Process Step', type:'input', placeholder:'e.g. Step 2: MAP' },
    { key:'feature', label:'Feature', type:'input', placeholder:'e.g. Historic financial model' },
    { key:'benefit', label:'Benefit', type:'textarea', placeholder:'Why the client cares...' },
    { key:'proof', label:'Proof Point', type:'input', placeholder:'e.g. Used by 40+ startups' }
  ], items: [] },
  competitors: { container: 'competitorsList', fields: [
    { key:'name', label:'Competitor', type:'input', placeholder:'e.g. Do Nothing / Generic Accountant' },
    { key:'positioning', label:'Their positioning', type:'textarea', placeholder:'What do they claim?' },
    { key:'advantage', label:'Your advantage', type:'textarea', placeholder:'Why clients choose you instead' },
    { key:'loseWhen', label:'When you lose', type:'textarea', placeholder:'Situations where you lose' }
  ], items: [] },
  objections: { container: 'objectionsList', fields: [
    { key:'objection', label:'Objection', type:'input', placeholder:'e.g. I have an accountant already' },
    { key:'response', label:'Response', type:'textarea', placeholder:'Acknowledge, reframe, prove, ask.' }
  ], items: [] },
  faqs: { container: 'faqsList', fields: [
    { key:'question', label:'Question', type:'input', placeholder:'What do prospects ask?' },
    { key:'answer', label:'Answer', type:'textarea', placeholder:'Your best answer...' }
  ], items: [] }
};

// ==================== PHELLOS DEFAULTS ====================
const PHELLOS_DEFAULTS = {
  clientName:'Phellos', workshopDate:'2026-02-20', facilitator:'Jordan', attendees:'', sessionGoals:'',
  dc_geography:'UK, EUROPE, USA\n\nThe USA closes quicker, understands finances more and the importance.\nUK harder to sell but they ask less questions',
  dc_industry:'SaaS, Fintech or any other subsector of tech.\nTech Logistics, gaming, QR menus, fintech, Turkish version of Crunchbase.\nAds business, operational safety tech business, health care tech, banks, AI tech.\n\nEnablement tech, how can we make it better with tech?\nTech services, software dev house, web design etc.\n\nAI tech, pure tech with another layer of AI on top.\n\nHardware enabled tech like "remarkable" as they have the hardest time with finances.\n\nSafety tech businesses.',
  dc_companySize:'As little as 5-10 people all the way up to 200-500.\n\n10-30 employees in the sweet spot.\nTypical startup',
  dc_fundingStage:'First time or second time founders who are either from the industry they are trying to change or people who do not want to deal with finance even if they have the experience.\n\nHow many years experience? 3-7 years',
  dc_jobTitles:'Typically we work with the founders for smaller companies.\nCEO and founder/ CEO/ Co-Founder\n\nBut with larger ones it is not uncommon to work with CFOs or COOs though not typical.',
  dc_personality:'Mostly Men. Men are more pre-emptive.\n\nThe ideal thing I\'m looking for is, diligent founder, someone who\'s always on it, understands the importance of finance, and a cohesive working environment. A high degree of energy, and humility.',
  dc_revenue:'Pre-Series A to Series C. Actively fundraising or preparing to raise.',
  dc_growthSignals:'Preparing for a funding round\nInvestor due diligence requirements incoming\nFailed or stalled fundraise\nRunway under 12 months\nBoard pressure on financial reporting',
  dc_teamStructure:'No dedicated finance team or CFO\nUsing a generalist bookkeeper or accountant\nFounder managing finances themselves',
  dc_techStack:'', dc_bestClients:'Mindsite - Because they\'re a no BS team, can be very direct.\n\nHelloKlean - Shower head that softens water\n\nBasicblock - I like working with them because\n\nThey all have clean operational data, and less complicated businesses',
  dc_dreamClients:'Canva would be a dream.\nUI Path\nRemarkable',
  wd_businessGoals:'Always "exit/IPO" long term\nMedium term goal is some form of profitability\nShort term goal is always "revenue growth"\n\nDaily goals are to focus on what they are good at doing (product, doing deals etc)\nReduce all the friction.',
  wd_personalDreams:'They all want to be rich, live like Mark Zuckerberg.\nThey want to be known in their industry for what they do.\nThey want to be respected by their peers.\nGet out of their peers/family/friends shadows.\nMake their parents proud.\nMake their family proud.\nChildhood dreams and aspirations.\nReach your full potential.',
  wd_problems:'Cant meet investor requirements.\nEverything they are presenting is wrong.\nThey know they have a problem, they just don\'t know the depth.\nThe investor requirements come through and they can\'t solve for it.\nReporting issues, they don\'t know how to report to investors.\nLow knowledge of how to run a business, bargain, question service providers.\nThey don\'t know how to run a business.\nThey do their job well but they don\'t have someone who\'s in control of their finances who understands their numbers.',
  wd_painSeverity:'8', wd_painCost:'', wd_fears:'Not getting funding, running out of money, going back to having a "job". Feeling like a loser and a failure and losing all respect for yourself and others around you. First time founder failing and then never being able to get funding again. They think this is their only shot.',
  wd_suspicions:'Accessibility, it\'s a remote team. Pricing is rarely an issue, but sometimes they don\'t understand what we do, and then it might be.',
  wd_enemies:'Complacency', wd_trends:'',
  wd_identityStory:'', wd_statusSignals:'', wd_communityBehavior:'', wd_contentPreferences:'', wd_decisionFramework:'',
  ri_budget:'3000-6000 GBP/month retainer. 30-Day Sprint starts at 3000 GBP.',
  ri_purchaseCycle:'1-3 weeks. Often urgent when funding round is approaching.',
  ri_procurementProcess:'Founder decision, minimal procurement process. Occasionally involves COO or board approval.',
  ri_paymentPreferences:'Monthly retainer. Some prefer project-based for initial sprint.',
  ri_lifetimeValue:'12-24 months at 3-6K/month = 36K-144K GBP lifetime value',
  ri_roiExpectation:'Protect or add 30% valuation during due diligence. ROI is 10-50x the retainer.',
  ri_costOfInaction:'10-30% valuation haircut during due diligence. Failed fundraise. Delayed funding by 3-6 months. Investor confidence destroyed.',
  ri_competingBudgets:'Legal counsel, product development, marketing spend',
  ri_priceSensitivity:'4',
  cm_socialPlatforms:'LinkedIn (primary), Twitter/X for tech founders',
  cm_contentFormats:'Podcasts, LinkedIn posts, founder newsletters, case studies',
  cm_events:'Web Summit, SaaStock, London Tech Week, TechCrunch Disrupt, local startup meetups',
  cm_communities:'Startup accelerators (Y Combinator, Techstars, Seedcamp), founder Slack groups, VC networks',
  cm_publications:'TechCrunch, Sifted, EU-Startups, The Information',
  cm_podcasts:'Startup/VC podcasts, founder story podcasts, finance for startups content',
  cm_influencers:'VC partners, accelerator mentors, successful founders in their network',
  cm_searchBehavior:'Google: "startup CFO services", "due diligence preparation", "investor reporting template"',
  cm_referralSources:'VCs who need portfolio companies cleaned up\nAccelerators recommending finance help\nFounder-to-founder referrals\nAccountants referring complex startup work',
  cm_outreachChannels:'Podcast invitations (primary)\nLinkedIn DMs and content\nVC partner referrals\nStartup event speaking',
  lm_jargon:'Due diligence, fundraise, runway, burn rate, MRR, ARR, cap table, data room, IPEV, Series A/B/C, term sheet, valuation',
  lm_wordsAvoid:'Bookkeeping, accountancy (too generic), cheap, basic',
  lm_tonePreference:'Direct, confident, no-BS. Like a trusted advisor, not a salesperson.',
  lm_painLanguage:'Can\'t meet investor requirements\nNumbers are a mess\nDon\'t know how to report to investors\nRunning out of time before the raise\nThis is their only shot',
  lm_aspirationLanguage:'Investor-ready from day one\nRaise with confidence\nFocus on building, not spreadsheets\nPass due diligence smoothly\nProtect your valuation',
  lm_objectionLanguage:'I have an accountant - he can handle it right?\nHow much do you help on strategy?\nI don\'t really need this',
  lm_socialProofType:'Successful due diligence outcomes\nValuation protection stories\nVC endorsements\n"Never failed a DD process"',
  lm_messagingDOs:'Quantify the risk (10-30% valuation haircut)\nUse "investor-ready" and "due diligence"\nReference the auditor background\nMake it urgent (funding timeline)',
  lm_messagingDONTs:'Don\'t say "bookkeeping" or "accounting services"\nDon\'t lead with price\nDon\'t use jargon the founder won\'t know\nDon\'t compare to accountants (different category)',
  trig_preparing:true, trig_boardPressure:true, trig_failedAudit:true, trig_runway:true, trig_newFunding:true,
  trig_top3:'1. Preparing for a funding round (Series A/B/C)\n2. Failed or stalled fundraise due to messy financials\n3. Investor requirements they can\'t meet',
  trig_custom:'New board member demanding proper reporting\nCFO departure leaving a gap\nAccountant unable to handle investor-grade work',
  trig_seasonality:'Q1 and Q3 are peak fundraising seasons',
  trig_budgetCycles:'Tied to fundraise timeline, not calendar year',
  trig_digitalSignals:'Crunchbase fundraise announcements\nLinkedIn posts about "exciting news coming"\nJob posts for CFO or finance roles\nAccelerator cohort graduations',
  trig_urgencyDrivers:'Runway under 12 months\nTerm sheet received with DD requirements\nInvestor meeting scheduled in next 30 days',
  trig_idealTiming:'3-6 months before planned fundraise is ideal. Most come 4-8 weeks before (too late but still doable).',
  bc_influenceMap:'Founder/CEO: Primary decision maker (especially in smaller companies)\nCOO/CFO: Involved in larger companies, focused on operational fit\nBoard/Investors: Often the ones pushing the founder to get proper finance help\nExisting accountant: Can be a blocker if they feel threatened',
  bc_dealKillers:'Existing accountant actively blocking\nFounder doesn\'t see value in proper financials\nNo fundraise planned (no urgency)\nBoard has already mandated a specific firm',
  bb_evaluationCriteria:'Industry expertise (do they understand startups?)\nTrack record with investors and due diligence\nResponsiveness and communication style\nPrice relative to fundraise size',
  bb_vendorComparison:'Traditional accountant vs. fractional CFO vs. Phellos\nAccountants do compliance, not strategy\nFractional CFOs are expensive full-time hires\nPhellos bridges both with investor-side expertise',
  bb_proofRequired:'Case studies from similar-stage startups\nReferences from VCs or investors\nExamples of successful due diligence outcomes',
  bb_trialExpectation:'Free Round Readiness Audit - no commitment needed to get value',
  bb_contractPreference:'Monthly retainer, flexible terms\n30-Day Sprint for quick wins\nNo long-term lock-in',
  bb_selectionTimeline:'1-3 weeks, accelerated when funding round is imminent',
  bb_implementationConcerns:'How quickly can you get up to speed on our numbers?\nWill you work with our existing accountant?\nHow much of our time will this take?',
  bb_successMetrics:'Clean due diligence pass\nValuation protection (no haircut)\nInvestor confidence in financials\nMonthly reporting on time',
  bb_switchingBarriers:'Relationship with existing accountant\nFear of changing systems mid-fundraise\nPerceived complexity of transition',
  ba_before:'The before state is unreconciled financials, poorly constructed accounting practices, limited view on financial performance, no sophisticated financial model. No reporting standards. As a result poor financial metrics, no narrative around financials. No data room',
  ba_steps:'1. Get the accounting records for the last 2 years.\n2. We map the accounting records and ingest it into the historic financial model.\n3. We ask the founder the questions about revenue, expenses, or anomalies, and understand their business model. (2-3 meetings)\n4. Well crunch out the first report, for them to review\n5. Move into the forecast (2-3 meetings), when they want to raise etc\n6. Data room set up, keeping the company sales ready at all times.\n7. Post onboarding\n8. Every month after that closes, we ingest that month\'s financials and review and ask questions, update forecasts and provide a report.',
  ba_after:'The after state is fully reconciled management accounts, full 5 year forecast, IPEV, monthly and quarterly reporting, metric sets, data room, fully reconciled reporting and dashboard. As a result they are able to raise funds from investors.\n\nNote we do not touch tax.',
  ba_frameworkName:'', ba_frameworkSteps:'', ba_frameworkSummary:'', ba_timeline:'',
  g_guarantee:'We have never failed a financial due diligence process ever.\nYour Due diligence process will run smoothly and quickly.\nIf they fail because of me will work for them for free for 3 months.\n\nWe will add 30% extra valuation to your company or XYZ\nWe will prevent the loss of 30% valuation of your company.',
  g_mechanism:'We are all auditors so we KNOW what they\'re looking for.',
  g_riskReversal:'If we fail your due diligence process, we work for free for 3 months.',
  g_valueStack:'Fully reconciled management accounts\n5-year financial forecast (IPEV compliant)\nMonthly/quarterly investor reporting\nComplete data room setup\nMetric dashboards\nOngoing fractional CFO partnership',
  g_dreamOutcome:'Pass due diligence smoothly, protect your valuation, and raise funds with confidence - so you can focus on building your product, not wrestling with spreadsheets.',
  np_timeWasters:'Pre-revenue companies with no funding\nCompanies not planning to raise\nFounders who want to do it themselves',
  np_cultureMismatch:'Founders who don\'t value finance or see it as optional\nCompanies with toxic internal politics\nMicromanagers who won\'t trust the process',
  np_overcomableFlags:'Small budget initially - can start with Sprint\nLimited financial data - that\'s exactly why they need Phellos',
  np_referOutTo:'Tax specialists, pure bookkeepers, companies needing full-time CFO hire',
  cp_differentiator:'We are all auditors - we KNOW what investors are looking for because we\'ve been on the other side of the table.',
  sp_qualificationCriteria:'Tech company with 5-500 employees\nPlanning to raise or currently raising\nNo dedicated CFO or finance team\nMinimum 2 years of trading history',
  sp_discoveryQuestions:'When are you planning to raise next?\nWhat does your current financial reporting look like?\nHave you been through due diligence before?\nWho handles your finances currently?\nWhat are your investors asking for that you can\'t provide?',
  sp_demoStrategy:'Round Readiness & Valuation Haircut Audit - free diagnostic call that quantifies the problem',
  sp_proposalStructure:'',
  sp_closingTechniques:'Quantify the valuation haircut risk\nShow the cost of delay (runway burning)\nReference similar companies who passed DD smoothly with Phellos\nGuarantee: never failed a DD process',
  sp_followUpCadence:'Day 1: Audit results email\nDay 3: Case study relevant to their stage\nDay 7: Check-in call\nDay 14: Final follow-up with urgency around funding timeline',
  er_upsellPaths:'30-Day Sprint to full monthly retainer\nBasic reporting to full CFO partnership\nOne-off data room to ongoing investor relations support',
  er_crossSell:'Board reporting packages\nM&A preparation\nFinancial modeling for new products/markets',
  er_expansionSignals:'Successful fundraise (need ongoing reporting)\nNew investor requirements\nPlanning next round\nGrowing team and complexity',
  er_retentionRisks:'Hiring a full-time CFO\nRunning out of funding\nFounder disengagement from finances',
  er_referralMechanism:'VC partners referring portfolio companies\nFounder-to-founder word of mouth\nAccountant referrals for complex startup work',
  er_churnReasons:'Hired internal CFO\nCompany shut down\nFundraise completed and founder thinks they don\'t need it anymore',
  er_advocacyProgram:'', er_renewalProcess:'Monthly auto-renewal. Quarterly business reviews to demonstrate ongoing value.',
  hs_expert:'Leo\'s business partner was CFO of a venture capital fund. Leo worked directly with startup founders after they raised millions.',
  hs_problem:'Startups consistently reported financials the wrong way. The VC side couldn\'t get proper reports, and the startup side didn\'t know how to do them.',
  hs_searched:'Tried working with traditional accountants and bookkeepers - they didn\'t understand startup metrics, investor expectations, or due diligence requirements.',
  hs_fedUp:'Built a system to bridge the gap between what investors need and what startups actually have.',
  hs_worked:'Startups started passing due diligence smoothly. Fundraising timelines compressed. Investors got clean, consistent reporting.',
  hs_asking:'Other VCs and founders started asking for the same service. Word spread through the startup ecosystem.',
  hs_mission:'Make every tech startup investor-ready from day one, so no founder loses funding because their numbers are a mess.',
  hs_narrative:'This started when my business partner was the CFO of a VC, having lots of trouble getting reports from startups, they all reported the wrong way. I tried to solve it and get reports.\n\nLeo was in startups and saw founders how to do financials after raising millions of dollars.\n\nOne side saw it from the fund side and I saw it from the fund side.',
  bs_website:'https://phellosconsultancy.co.uk', bs_product:'Finance consultancy for tech startups - investor due diligence, revenue reconciliation, financial modeling',
  bs_annualRevenue:'', bs_employees:'Small team (co-founders + associates)', bs_newCustomersMonth:'', bs_avgDealSize:'3000-6000 GBP/month',
  bs_sellingMechanism:'Founder-Led Sales', bs_deliveryType:'Done-For-You (Service)',
  bs_leadSource:'Referrals / Word of Mouth', bs_advertisingMode:'Cold Outreach',
  bs_growthConstraint:'Lead quality', bs_techStatus:'',
  bs_salesCycle:'1-3 weeks (accelerates when fundraise is imminent)',
  bs_closeRate:'', bs_qualifiedLeads:'', bs_salesTeamSize:'Founder-led (Leo)',
  bs_monthlySpend:'', bs_pipelineValue:'', bs_monthlyLeads:'', bs_conversionRate:'',
  bs_leadToCustomer:'', bs_followUpSLA:'Reply within 24 hours', bs_competitors:'Generic accountants and bookkeepers\nFractional CFO services\nBig 4 / mid-tier audit firms (for larger companies)\nDo Nothing (founder handles it themselves)', bs_messagingAngles:'Investor-ready financials\nValuation protection (prevent 10-30% haircut)\nAuditors who know what investors look for\nNever failed a due diligence process',
  bs_totalCustomers:'', bs_aov:'3000-6000 GBP/month', bs_cac:'', bs_ltv:'36,000-144,000 GBP (12-24 month avg engagement)', bs_churnRate:'', bs_nps:'', bs_customerSegments:'Pre-Series A startups (Sprint focus)\nSeries A-B companies (ongoing retainer)\nHardware-enabled tech (most complex finances)',
  bs_monthlyRevenue:'', bs_grossMargin:'', bs_netMargin:'', bs_mrrGrowth:'',
  bs_burnRate:'', bs_runway:'', bs_yearlyProfit:'', bs_productLines:'',
  bs_revenueGoal:'', bs_mainGrowthChannel:'', bs_growthStrategy:'', bs_growthConstraints:'',
  bs_fundingNeeded:'', bs_exitTimeline:'', bs_exitTarget:'',
  bs_custAcquisition:'Referrals from VCs and accelerators\nFounder-to-founder word of mouth\nPodcast appearances\nLinkedIn content and DMs', bs_custOnboarding:'1. Collect 2 years accounting records\n2. Map into historic financial model\n3. 2-3 founder Q&A sessions\n4. First report delivery\n5. Forecast + data room setup', bs_serviceDelivery:'Remote team, fully digital. Monthly data ingestion, reconciliation, reporting, and forecast updates.', bs_teamStructureOps:'Co-founders (Leo + partner) + associate team',
  bs_workflowStages:'Collect > Map > Diagnose > Report > Forecast > Data Room > Ongoing Monthly', bs_qualityMetrics:'100% DD pass rate\nOn-time monthly reporting\nValuation protection metrics', bs_dataAnalytics:'Financial modeling tools, accounting integrations', bs_scheduling:'Monthly review cadence, ad-hoc meetings around fundraise milestones',
  bs_toolsFinance:'', bs_toolsAnalytics:'', bs_toolsSales:'', bs_toolsMarketing:'', bs_toolsOther:'',
  bs_brandVoice:'Direct, confident, no-BS. Like a trusted advisor, not a salesperson. Professional but approachable.', bs_prohibitedTerms:'Bookkeeping, accountancy (too generic), cheap, basic', bs_trustSignals:'We have never failed a financial due diligence process\nAll team members are qualified auditors\nExperience from both investor and startup side',
  bs_licenses:'', bs_adRestrictions:'',
  bs_differentiators:'We are all auditors so we KNOW what they are looking for', bs_proofAssets:'Case studies: Mobile Commons, Mindsite, Ease Global, Basic Block, Wamo, Octopus\nVC endorsements\nSuccessful DD outcomes', bs_offerPackages:'1. Free: Round Readiness & Valuation Haircut Audit\n2. Sprint: 30-Day Round Readiness Sprint (3,000 GBP)\n3. Core: Audit-Proof Finance Department (3-6K GBP/month retainer)', bs_promotions:'',
  _lists: {
    caseStudies:[{name:'Mobile Commons',before:'',after:'',metric:'',notes:'Most likely to give case study'},{name:'Mindsite',before:'',after:'',metric:'',notes:''},{name:'Ease Global',before:'',after:'',metric:'',notes:''},{name:'Basic Block',before:'',after:'',metric:'',notes:'Most likely to give case study'},{name:'Wamo',before:'',after:'',metric:'',notes:''},{name:'Octopus',before:'',after:'',metric:'',notes:''}],
    features:[
      {step:'Step 1: COLLECT',feature:'Historic data ingestion',benefit:'We pull 2 years of accounting records and map every transaction so nothing is missed',proof:'Used by 40+ startups across SaaS, fintech, and hardware-enabled tech'},
      {step:'Step 2: MAP',feature:'Historic financial model',benefit:'Your raw data is transformed into a clean, investor-grade financial model that tells the real story',proof:'Catches 10-30% valuation discrepancies that generic accountants miss'},
      {step:'Step 3: DIAGNOSE',feature:'Founder Q&A sessions (2-3 meetings)',benefit:'We deep-dive into revenue, expenses, and anomalies - understanding your business model inside out',proof:'Identifies blind spots founders didn\'t know existed'},
      {step:'Step 4: REPORT',feature:'First financial report',benefit:'Your first reconciled report gives you instant visibility into true financial health',proof:'Founders say "I finally understand my own numbers"'},
      {step:'Step 5: FORECAST',feature:'5-year financial forecast (IPEV compliant)',benefit:'Investor-ready projections that pass due diligence scrutiny',proof:'Built by auditors who know exactly what the other side checks'},
      {step:'Step 6: DATA ROOM',feature:'Complete data room setup',benefit:'Everything investors need - organised, accessible, always up to date. Company stays "sales ready"',proof:'Reduces DD timeline from months to weeks'},
      {step:'Step 7: ONBOARD',feature:'Post-onboarding handoff',benefit:'Seamless transition to ongoing support with no gaps in coverage',proof:'100% client retention through onboarding phase'},
      {step:'Step 8: MONITOR',feature:'Monthly financial review + reporting',benefit:'Every month\'s financials are ingested, reviewed, questioned, and reported. Forecasts updated automatically.',proof:'Clients report 50% less time spent on finance admin'}
    ],
    competitors:[{name:'Do Nothing',positioning:'Founders try to handle finances themselves or ignore them until fundraise',advantage:'We prevent the 10-30% valuation haircut they don\'t see coming. The cost of doing nothing is far higher than the retainer.',loseWhen:'Founder is not planning to raise and has no investor pressure'},{name:'Generic Accountant',positioning:'Tax compliance, bookkeeping, year-end accounts',advantage:'Accountants do compliance, not investor-ready financials. We are auditors who know what investors look for because we\'ve been on the fund side.',loseWhen:'Company only needs basic compliance and has no investor-facing needs'},{name:'Fractional CFO',positioning:'Part-time senior finance hire, strategic advisory',advantage:'We combine operational finance work with due diligence expertise at a fraction of a full-time CFO cost. Plus we\'ve sat on the investor side.',loseWhen:'Company wants a senior executive who attends board meetings and manages a finance team'}],
    objections:[{objection:'I have an accountant, he can handle it right?',response:'Your accountant handles compliance and tax. We handle investor-grade financials - reconciled management accounts, forecasts, data rooms, and due diligence preparation. These are completely different skillsets. Has your accountant ever sat on the other side of a due diligence table?'},{objection:'How much do you help on strategy?',response:'Our core is making your numbers tell the right story. We build the financial models, forecasts, and reporting that inform strategy. We don\'t replace your business strategy - we give you the financial clarity to make better strategic decisions.'},{objection:'I don\'t really need this.',response:'Most founders say that until they\'re 4 weeks from a term sheet and their numbers don\'t reconcile. The cost of being unprepared is a 10-30% valuation haircut or a failed raise entirely. When are you planning to raise next?'}],
    faqs:[
      {question:'How long does it take to get set up?',answer:'The 30-Day Sprint gets you investor-ready in 30 days. Full onboarding for ongoing retainer takes 2-3 weeks of initial meetings, then you\'re on autopilot.'},
      {question:'Do you replace our accountant?',answer:'No. Your accountant handles tax compliance. We handle investor-grade financials - management accounts, forecasts, data rooms, and DD prep. Completely different skillsets. We work alongside your accountant.'},
      {question:'What if we\'re not planning to raise right now?',answer:'Even better - you get your house in order before the pressure hits. Founders who come to us 3-6 months before a raise get 2-3x better outcomes than those who come 4 weeks before.'},
      {question:'How is this different from hiring a fractional CFO?',answer:'A fractional CFO is a senior executive hire at 5-10x our cost. We combine hands-on operational finance work with due diligence expertise - and we\'ve sat on the investor side of the table. You get CFO-level insight at a fraction of the price.'},
      {question:'What size companies do you work with?',answer:'Typically 5-500 employees, with the sweet spot being 10-30 employee startups at pre-Series A to Series B stage. We work across SaaS, fintech, and tech-enabled businesses.'},
      {question:'What does the monthly retainer include?',answer:'Monthly data ingestion, reconciled management accounts, forecast updates, investor reporting, data room maintenance, and direct access to our team for financial questions. Think of it as a fully outsourced finance department.'}
    ]
  }
};

// ==================== THEME ====================
function toggleTheme() {
  document.documentElement.classList.toggle('light');
  localStorage.setItem('vpTheme', document.documentElement.classList.contains('light') ? 'light' : 'dark');
}

// ==================== STORAGE ====================
function getStorageKey(name) {
  return 'vp_' + (name||'untitled').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');
}
function saveToLS() {
  try {
    const data = collectState();
    data._version = (data._version||0)+1;
    data._lastSaved = new Date().toISOString();
    const key = getStorageKey(data.clientName);
    localStorage.setItem(key, JSON.stringify(data));
    localStorage.setItem('vp_last_client', key);
    currentClientKey = key;
    updateSavedClientIndex(data.clientName, key);
    showSaveStatus('saved');
    return true;
  } catch(e) { showSaveStatus('error'); return false; }
}
function loadFromLS(key) { try { return JSON.parse(localStorage.getItem(key)); } catch(e) { return null; } }
function updateSavedClientIndex(name, key) {
  try { const idx=JSON.parse(localStorage.getItem('vp_client_index')||'{}'); idx[key]={name,lastSaved:new Date().toISOString()}; localStorage.setItem('vp_client_index',JSON.stringify(idx)); } catch(e) {}
}
function getSavedClients() { try { return JSON.parse(localStorage.getItem('vp_client_index')||'{}'); } catch(e) { return {}; } }

// IndexedDB
function openDB() { return new Promise((res,rej)=>{ const r=indexedDB.open(DB_NAME,DB_VERSION); r.onupgradeneeded=e=>e.target.result.createObjectStore(STORE_NAME); r.onsuccess=()=>res(r.result); r.onerror=()=>rej(r.error); }); }
async function saveToIDB(key,data) { try { const db=await openDB(); db.transaction(STORE_NAME,'readwrite').objectStore(STORE_NAME).put(data,key); } catch(e){} }

// ==================== STATE ====================
function collectState() {
  document.querySelectorAll('[data-field]').forEach(el=>{
    if(el.type==='checkbox') state[el.dataset.field]=el.checked;
    else state[el.dataset.field]=el.value;
  });
  state._lists={};
  for(const id of Object.keys(listDefs)) state._lists[id]=[...listDefs[id].items];
  return state;
}

function populateForm(data) {
  state={...data};
  document.querySelectorAll('[data-field]').forEach(el=>{
    const v=data[el.dataset.field]; if(v===undefined) return;
    if(el.type==='checkbox') el.checked=!!v;
    else if(el.type==='range') { el.value=v; const d=el.parentElement.querySelector('.slider-value'); if(d)d.textContent=v; }
    else { el.value=v; if(el.tagName==='TEXTAREA') autoResize(el); }
  });
  if(data._lists) for(const[id,items] of Object.entries(data._lists)) { if(listDefs[id]){listDefs[id].items=[...items.map(i=>({...i}))]; renderDynamicList(id);} }
  updateClientBadge(); updateProgress(); updateLiveSummary(); updateMessagingMatrix();
}

function debouncedSave() {
  showSaveStatus('saving');
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(()=>{ saveToLS(); updateProgress(); updateLiveSummary(); updateMessagingMatrix(); }, SAVE_DEBOUNCE);
}

// ==================== DYNAMIC LISTS ====================
function renderDynamicList(id) {
  const def=listDefs[id]; const c=document.getElementById(def.container); if(!c) return;
  c.innerHTML = def.items.map((item,i)=>{
    const fh = def.fields.map(f=>{
      const v=(item[f.key]||'').replace(/"/g,'&quot;');
      if(f.type==='textarea') return `<div class="field-group"><label>${f.label}</label><textarea data-key="${f.key}" data-list="${id}" data-index="${i}" placeholder="${f.placeholder||''}" oninput="updateListItem('${id}',${i},'${f.key}',this.value);autoResize(this);debouncedSave();">${item[f.key]||''}</textarea></div>`;
      return `<div class="field-group"><label>${f.label}</label><input type="text" data-key="${f.key}" data-list="${id}" data-index="${i}" placeholder="${f.placeholder||''}" value="${v}" oninput="updateListItem('${id}',${i},'${f.key}',this.value);debouncedSave();"></div>`;
    }).join('');
    return `<div class="dynamic-item"><div class="item-header"><span class="item-number">#${i+1}</span><button class="item-remove" onclick="removeListItem('${id}',${i})">Remove</button></div><div class="item-fields">${fh}</div></div>`;
  }).join('');
  c.querySelectorAll('textarea').forEach(autoResize);
}
function addListItem(id) { const def=listDefs[id]; const n={}; def.fields.forEach(f=>n[f.key]=''); def.items.push(n); renderDynamicList(id); debouncedSave(); const c=document.getElementById(def.container); if(c.lastElementChild) c.lastElementChild.scrollIntoView({behavior:'smooth',block:'center'}); }
function removeListItem(id,i) { listDefs[id].items.splice(i,1); renderDynamicList(id); debouncedSave(); }
function updateListItem(id,i,key,val) { if(listDefs[id].items[i]) listDefs[id].items[i][key]=val; }

// ==================== UI ====================
function autoResize(el) { if(!el||el.tagName!=='TEXTAREA') return; el.style.height='auto'; el.style.height=Math.max(el.scrollHeight,40)+'px'; }

function showSaveStatus(s) {
  const el=document.getElementById('saveStatus'); const t=document.getElementById('saveText');
  el.className='save-status '+s;
  if(s==='saving') t.textContent='Saving...';
  else if(s==='saved') t.textContent='Saved '+new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
  else if(s==='error') t.textContent='Failed!';
}

function updateClientBadge() {
  const n=state.clientName||document.querySelector('[data-field="clientName"]')?.value||'-';
  document.getElementById('clientBadge').textContent=n;
  document.title='VP Workshop - '+n;
}

function updateProgress() {
  const sections=document.querySelectorAll('.workshop-section');
  let totalF=0, totalFilled=0;
  sections.forEach(sec=>{
    const fields=sec.querySelectorAll('textarea[data-field],input[type="text"][data-field],input[type="date"][data-field]');
    const listFields=sec.querySelectorAll('textarea[data-key],input[data-key]');
    let filled=0, total=fields.length+listFields.length;
    fields.forEach(f=>{ if(f.value&&f.value.trim()) filled++; });
    listFields.forEach(f=>{ if(f.value&&f.value.trim()) filled++; });
    totalF+=total; totalFilled+=filled;
    const navItem=document.querySelector(`[data-nav="${sec.id}"]`);
    const dot=navItem?.querySelector('.nav-dot');
    if(dot) { if(total===0||filled===0) dot.className='nav-dot'; else if(filled>=total*0.6) dot.className='nav-dot complete'; else dot.className='nav-dot partial'; }
    if(navItem&&total>0) { let badge=navItem.querySelector('.nav-progress'); if(!badge){badge=document.createElement('span');badge.className='nav-progress';navItem.appendChild(badge);} badge.textContent=filled+'/'+total; badge.classList.toggle('done',filled>=total*0.6); }
  });
  const pct=totalF>0?Math.round((totalFilled/totalF)*100):0;
  document.getElementById('progressValue').textContent=pct+'%';
  const circ=document.getElementById('progressRing');
  const circumference=81.68;
  circ.style.strokeDashoffset=circumference-(pct/100)*circumference;
  circ.classList.toggle('high', pct >= 80);
  // Section completion celebration
  if(navItem&&total>0&&filled>=total) {
    if(!sec.classList.contains('section-complete')) {
      sec.classList.add('section-complete');
      showToast(sec.querySelector('.section-banner')?.textContent?.replace('Copy','').trim()+' - Section complete!','success');
    }
  } else { sec.classList.remove('section-complete'); }
}

// ==================== LIVE SUMMARY ====================
function updateLiveSummary() {
  collectState();
  const s=state;
  const trunc=(str,len)=>{ if(!str) return ''; const l=str.split('\n')[0]; return l.length>len?l.substring(0,len)+'...':l; };
  const filled=(v)=>v&&v.trim();

  const client=s.clientName||'...';
  const industry=trunc(s.dc_industry,60)||'Not yet defined';
  const geo=trunc(s.dc_geography,40)||'...';
  const size=trunc(s.dc_companySize,50)||'...';
  const pain=trunc(s.wd_problems,80)||'Not yet defined';
  const severity=s.wd_painSeverity||'?';
  const fear=trunc(s.wd_fears,80)||'...';
  const before=trunc(s.ba_before,80)||'...';
  const after=trunc(s.ba_after,80)||'...';
  const framework=s.ba_frameworkName||'';
  const guarantee=trunc(s.g_guarantee,80)||'Not yet defined';
  const mechanism=trunc(s.g_mechanism,80)||'...';
  const dreamOutcome=s.g_dreamOutcome||'';
  const differentiator=trunc(s.cp_differentiator,80)||'';

  // Auto-generate one-liner
  let oneliner='';
  if(filled(s.dc_industry)&&filled(s.wd_problems)) {
    const who=trunc(s.dc_industry,40);
    const painShort=trunc(s.wd_problems,50);
    const outcomeShort=trunc(s.g_dreamOutcome||s.ba_after,50);
    oneliner=`We help ${who} who struggle with ${painShort.toLowerCase()} ${outcomeShort?'to '+outcomeShort.toLowerCase():'achieve their goals'}${s.g_mechanism?' through '+trunc(s.g_mechanism,40).toLowerCase():''}.`;
  }

  document.getElementById('liveSummary').innerHTML=`
    ${oneliner?`<div class="rp-oneliner"><div class="rp-oneliner-label">Auto-Generated Value Prop</div>${oneliner}</div>`:''}
    <div class="rp-section"><div class="rp-label">Target ICP</div><div class="rp-value${filled(s.dc_industry)?'':' empty'}">${industry}</div></div>
    <div class="rp-section"><div class="rp-label">Geography</div><div class="rp-value${filled(s.dc_geography)?'':' empty'}">${geo}</div></div>
    <div class="rp-section"><div class="rp-label">Company Size</div><div class="rp-value${filled(s.dc_companySize)?'':' empty'}">${size}</div></div>
    <hr class="rp-divider">
    <div class="rp-section"><div class="rp-label">#1 Pain (Severity: ${severity}/10)</div><div class="rp-value${filled(s.wd_problems)?'':' empty'}">${pain}</div></div>
    <div class="rp-section"><div class="rp-label">Deepest Fear</div><div class="rp-value${filled(s.wd_fears)?'':' empty'}">${fear}</div></div>
    <hr class="rp-divider">
    <div class="rp-section"><div class="rp-label">Before</div><div class="rp-value${filled(s.ba_before)?'':' empty'}">${before}</div></div>
    <div class="rp-section"><div class="rp-label">After</div><div class="rp-value${filled(s.ba_after)?'':' empty'}">${after}</div></div>
    ${framework?`<div class="rp-section"><div class="rp-label">Framework</div><div class="rp-value">${framework}</div></div>`:''}
    <hr class="rp-divider">
    <div class="rp-section"><div class="rp-label">Guarantee</div><div class="rp-value${filled(s.g_guarantee)?'':' empty'}">${guarantee}</div></div>
    <div class="rp-section"><div class="rp-label">Unique Mechanism</div><div class="rp-value${filled(s.g_mechanism)?'':' empty'}">${mechanism}</div></div>
    ${differentiator?`<div class="rp-section"><div class="rp-label">Differentiator</div><div class="rp-value">${differentiator}</div></div>`:''}
    ${dreamOutcome?`<div class="rp-section"><div class="rp-label">Dream Outcome</div><div class="rp-value">${dreamOutcome}</div></div>`:''}
  `;
}

// ==================== TOAST NOTIFICATIONS ====================
function showToast(msg, type='success') {
  const c = document.getElementById('toastContainer');
  const t = document.createElement('div');
  t.className = 'toast ' + type;
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(() => t.remove(), 3200);
}

// ==================== SESSION TIMER ====================
let sessionStartTime = Date.now();
function updateTimer() {
  const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
  const h = Math.floor(elapsed / 3600);
  const m = Math.floor((elapsed % 3600) / 60);
  const s = elapsed % 60;
  const display = document.getElementById('timerDisplay');
  if (display) display.textContent = h > 0 ? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` : `${m}:${String(s).padStart(2,'0')}`;
}

// ==================== COPY SECTION ====================
function copySection(sectionId) {
  const sec = document.getElementById(sectionId);
  if (!sec) return;
  const fields = sec.querySelectorAll('textarea[data-field],input[type="text"][data-field],input[type="date"][data-field]');
  const listFields = sec.querySelectorAll('textarea[data-key],input[data-key]');
  const banner = sec.querySelector('.section-banner');
  const title = banner ? banner.textContent.replace('Copy','').trim() : sectionId;
  let text = '## ' + title + '\n\n';
  fields.forEach(f => {
    const label = f.closest('.field-group')?.querySelector('label')?.textContent || f.dataset.field;
    if (f.value && f.value.trim()) text += '**' + label + ':** ' + f.value.trim() + '\n\n';
  });
  // hero table
  sec.querySelectorAll('.hero-table tr').forEach(row => {
    const prompt = row.cells[0]?.textContent?.trim();
    const val = row.querySelector('textarea')?.value?.trim();
    if (prompt && val) text += '**' + prompt + ':** ' + val + '\n\n';
  });
  navigator.clipboard.writeText(text).then(() => {
    showToast('Section copied to clipboard');
    const btn = sec.querySelector('.copy-section-btn');
    if (btn) { btn.classList.add('copied'); btn.innerHTML = '\u2713'; setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = '\u2398'; }, 1500); }
  });
}

function injectCopyButtons() {
  document.querySelectorAll('.section-banner').forEach(banner => {
    const sec = banner.closest('.workshop-section');
    if (!sec || sec.id === 's13') return;
    const btn = document.createElement('button');
    btn.className = 'copy-section-btn';
    btn.innerHTML = '\u2398';
    btn.title = 'Copy section to clipboard';
    btn.onclick = (e) => { e.stopPropagation(); copySection(sec.id); };
    banner.appendChild(btn);
  });
}

// ==================== MESSAGING MATRIX ====================
function updateMessagingMatrix() {
  collectState();
  const s = state;
  const filled = v => v && v.trim();
  const first = v => (v||'').split('\n')[0].trim();
  const grid = document.getElementById('messagingMatrix');
  if (!grid) return;

  const industry = first(s.dc_industry);
  const pain = first(s.wd_problems);
  const after = first(s.ba_after);
  const guarantee = first(s.g_guarantee);
  const mechanism = first(s.g_mechanism);
  const framework = s.ba_frameworkName || '';
  const dreamOutcome = first(s.g_dreamOutcome);
  const differentiator = first(s.cp_differentiator);
  const fear = first(s.wd_fears);

  if (!filled(s.dc_industry) && !filled(s.wd_problems)) {
    grid.innerHTML = '<div class="matrix-card full-width"><h4>Waiting for Data</h4><p class="empty-hint">Fill in Dream Client Profile and What Drives Them to generate messaging.</p></div>';
    return;
  }

  const who = industry || 'your target clients';
  const painLC = pain ? pain.toLowerCase() : 'their core challenges';
  const outcome = dreamOutcome || after || 'achieve their goals';
  const mech = mechanism || '';

  const positioning = `We help ${who} who struggle with ${painLC} to ${outcome.toLowerCase()}${mech ? ' through ' + mech.toLowerCase() : ''}.`;
  const elevator = `Most ${who} face a critical problem: ${painLC}. ${fear ? 'They fear ' + fear.toLowerCase() + '. ' : ''}${s.clientName || 'We'} solve${s.clientName ? 's' : ''} this${framework ? ' with the ' + framework : ''} - delivering ${outcome.toLowerCase()}. ${guarantee ? 'We back it up: ' + guarantee.toLowerCase() + '.' : ''}`;

  const subjects = [];
  if (filled(s.wd_problems)) subjects.push(`Are ${painLC} costing you more than you think?`);
  if (filled(s.ba_after)) subjects.push(`How to go from ${first(s.ba_before).substring(0,30).toLowerCase()}... to ${first(s.ba_after).substring(0,30).toLowerCase()}`);
  if (filled(s.g_guarantee)) subjects.push(`${first(s.g_guarantee)}`);
  if (subjects.length === 0) subjects.push('Fill in more sections to generate subject lines');

  const hooks = [];
  if (filled(s.wd_fears)) hooks.push(`Stop worrying about ${fear.toLowerCase()}. Here is the fix.`);
  if (filled(s.g_dreamOutcome)) hooks.push(`What if you could ${dreamOutcome.toLowerCase()} in the next 90 days?`);
  if (filled(s.cp_differentiator)) hooks.push(`Unlike generic solutions, ${differentiator.toLowerCase()}`);
  if (hooks.length === 0) hooks.push('Fill in Guarantee and Competitive sections for ad hooks');

  const linkedIn = filled(s.dc_industry) ? `Helping ${who} ${dreamOutcome ? dreamOutcome.toLowerCase() : 'solve ' + painLC}${mech ? ' | ' + mech : ''}` : 'Fill in sections above';
  const hero = filled(s.ba_before) && filled(s.ba_after) ? `From ${first(s.ba_before).toLowerCase()} to ${first(s.ba_after).toLowerCase()}.` : 'Fill in Before/After section';

  grid.innerHTML = `
    <div class="matrix-card full-width"><h4>Positioning Statement</h4><p>${positioning}</p></div>
    <div class="matrix-card full-width"><h4>Elevator Pitch (30 sec)</h4><p>${elevator}</p></div>
    <div class="matrix-card"><h4>Website Hero Headline</h4><p>${hero}</p></div>
    <div class="matrix-card"><h4>LinkedIn Headline</h4><p>${linkedIn}</p></div>
    <div class="matrix-card full-width"><h4>Email Subject Lines</h4>${subjects.map(s=>'<p>'+s+'</p>').join('')}</div>
    <div class="matrix-card full-width"><h4>Ad Copy Hooks</h4>${hooks.map(h=>'<p>'+h+'</p>').join('')}</div>
  `;
}

function copyAllMessaging() {
  const cards = document.querySelectorAll('#messagingMatrix .matrix-card');
  let text = '# Messaging Matrix\n\n';
  cards.forEach(c => {
    const title = c.querySelector('h4')?.textContent || '';
    const paras = Array.from(c.querySelectorAll('p')).map(p => p.textContent).join('\n');
    text += '## ' + title + '\n' + paras + '\n\n';
  });
  navigator.clipboard.writeText(text).then(() => showToast('All messaging copied'));
}

// ==================== RIGHT PANEL TABS ====================
function switchRPTab(tab) {
  document.querySelectorAll('.rp-tab').forEach(t => t.classList.toggle('active', t.textContent.trim().toLowerCase() === tab));
  document.getElementById('rpSummaryTab').classList.toggle('active', tab === 'summary');
  document.getElementById('rpCoachTab').classList.toggle('active', tab === 'coach');
  if (tab === 'coach') updateCoachSuggestions();
}

// ==================== AI COACHING ENGINE (Rule-Based) ====================
function updateCoachSuggestions() {
  collectState();
  const s = state;
  const filled = v => v && v.trim() && v.trim().length > 3;
  const short = v => v && v.trim() && v.trim().length < 25;
  const suggestions = [];

  // Critical empty fields
  const criticalFields = [
    ['dc_industry', 'Dream Client Profile', 'Industry/Verticals - this drives your entire targeting'],
    ['dc_companySize', 'Dream Client Profile', 'Company Size - needed for campaign filtering'],
    ['wd_problems', 'Psychographic Depth', 'Problems - this becomes your #1 marketing message'],
    ['wd_fears', 'Psychographic Depth', 'Fears - fear-based messaging converts highest'],
    ['ba_before', 'Before/After', 'Before State - needed for contrast messaging'],
    ['ba_after', 'Before/After', 'After State - this is what you sell'],
    ['g_guarantee', 'Guarantee', 'Guarantee - closes 30% more deals'],
    ['g_mechanism', 'Guarantee', 'Unique Mechanism - why YOU can deliver this'],
    ['ri_costOfInaction', 'Revenue Intelligence', 'Cost of Inaction - your strongest urgency lever'],
    ['lm_painLanguage', 'Language DNA', 'Pain Language - use their exact words in campaigns'],
  ];
  criticalFields.forEach(([key, section, hint]) => {
    if (!filled(s[key])) suggestions.push({ type: 'missing', section, text: hint });
  });

  // Vague/short answers
  if (filled(s.dc_industry) && short(s.dc_industry)) suggestions.push({ type: 'suggest', section: 'Dream Client Profile', text: 'Industry answer is brief. Add sub-sectors, company types, and revenue ranges for sharper targeting.' });
  if (filled(s.wd_problems) && !s.wd_problems.includes('\n')) suggestions.push({ type: 'suggest', section: 'Psychographic Depth', text: 'List multiple problems (one per line). The more problems you capture, the more messaging angles you have.' });
  if (filled(s.g_guarantee) && !s.g_guarantee.toLowerCase().includes('if')) suggestions.push({ type: 'suggest', section: 'Guarantee', text: 'Strong guarantees use "if/then" format: "If X doesn\'t happen, then Y." Try restructuring yours.' });

  // Missing quantification
  if (filled(s.wd_problems) && !filled(s.wd_painCost)) suggestions.push({ type: 'question', section: 'Psychographic Depth', text: 'You listed problems but haven\'t quantified the cost. What does this problem cost them in money, time, or opportunities?' });
  if (filled(s.ba_after) && !filled(s.ba_timeline)) suggestions.push({ type: 'question', section: 'Before/After', text: 'You defined the After state but no timeline. How fast can clients expect to see results?' });

  // Incomplete patterns
  if (filled(s.ba_before) && !filled(s.ba_after)) suggestions.push({ type: 'missing', section: 'Before/After', text: 'Before state is filled but After is empty. Complete the transformation picture.' });
  if (filled(s.ba_steps) && !filled(s.ba_frameworkName)) suggestions.push({ type: 'suggest', section: 'Before/After', text: 'You have process steps but no framework name. Give it a catchy, memorable name clients will remember.' });
  if (filled(s.dc_industry) && !filled(s.cm_outreachChannels)) suggestions.push({ type: 'question', section: 'Channel & Media', text: 'You know your ICP but haven\'t mapped outreach channels. Where do these people hang out online?' });
  if (filled(s.dc_bestClients) && !filled(s.sp_discoveryQuestions)) suggestions.push({ type: 'suggest', section: 'Sales Process', text: 'You have great client examples. Now document the discovery questions that surface these kinds of clients.' });

  // Case study check
  const cases = s._lists?.caseStudies || [];
  const casesMissingMetrics = cases.filter(c => c.name && !c.metric);
  if (casesMissingMetrics.length > 0) suggestions.push({ type: 'suggest', section: 'Case Studies', text: `${casesMissingMetrics.length} case study(s) missing key metrics. Quantify: revenue impact, time saved, % improvement.` });

  // Render
  const container = document.getElementById('coachSuggestions');
  if (!container) return;
  if (suggestions.length === 0) {
    container.innerHTML = '<div class="coach-empty">Looking good! All critical fields have content. Keep adding detail to improve your messaging.</div>';
    return;
  }
  container.innerHTML = suggestions.map(s => `
    <div class="coach-card">
      <div class="coach-card-label ${s.type}">${s.type === 'missing' ? 'Missing' : s.type === 'suggest' ? 'Suggestion' : 'Question'} - ${s.section}</div>
      <p>${s.text}</p>
    </div>
  `).join('');
}

// ==================== AI SUGGESTIONS (via Apps Script + Claude API) ====================
//
// APPS SCRIPT TROUBLESHOOTING GUIDE:
// -----------------------------------
// The Apps Script acts as a serverless proxy for Claude AI + Google Drive backup.
// Source code: vp-workshop-drive-backup.gs (same directory as this file)
// Script Editor: https://script.google.com (search "VP Workshop" in Jordan's dopaminedigital.io account)
//
// CRITICAL RULES (learned the hard way):
// 1. URL FORMAT: Must use /macros/s/DEPLOYMENT_ID/exec (PUBLIC url).
//    NEVER use /a/macros/dopaminedigital.io/... (workspace-scoped, breaks external access).
// 2. GET vs POST: GET requests work reliably. POST requests fail due to Google's 302
//    redirect stripping the POST body. Use GET for ping/restore/list. POST still works
//    for backup/AI because the browser fetch API handles the redirect differently than curl.
// 3. REDEPLOYMENT: After changing the .gs code, you MUST redeploy:
//    Deploy > Manage Deployments > pencil icon > Version: New version > Deploy
//    The URL stays the same. If you do "New Deployment" instead, you get a NEW URL
//    and must update it here.
// 4. ACCESS: Deploy as "Execute as: Me" + "Who has access: Anyone".
//    Google Workspace may restrict "Anyone" - if so, admin must enable it.
// 5. SCRIPT PROPERTIES: Set in Apps Script Editor > Project Settings > Script Properties:
//    - ANTHROPIC_API_KEY (required for AI coaching)
//    - BRAVE_API_KEY (optional, for live web research)
// 6. TESTING: curl -s -L "URL?action=ping" should return {"ok":true,"folder":"VP Workshop Backups"}
//    If it returns HTML or "page not found", the deployment is broken. Redeploy.
//
let appsScriptUrl = 'https://script.google.com/macros/s/AKfycbygHn_ikDKMNWdmPZsVe7IzmbJTtQWF3wmG7_ItvXdSW7CqPVzjCXRTP7EOOPndmhXg/exec';

let aiSuggestTimeout = null;
let lastAiSectionData = '';

async function requestAISuggestions() {
  if (!appsScriptUrl) return;
  collectState();
  const secs = document.querySelectorAll('.workshop-section');
  let activeSec = 's0', activeLabel = 'Setup';
  secs.forEach(s => { if (s.getBoundingClientRect().top <= 200) { activeSec = s.id; activeLabel = s.querySelector('.section-banner')?.textContent?.trim() || activeSec; } });
  const sectionData = {};
  const sec = document.getElementById(activeSec);
  if (sec) sec.querySelectorAll('[data-field]').forEach(el => { if (el.value) sectionData[el.dataset.field] = el.type === 'checkbox' ? el.checked : el.value; });
  // Skip if section data hasn't changed
  const dataKey = JSON.stringify(sectionData);
  if (dataKey === lastAiSectionData || Object.keys(sectionData).length < 2) return;
  lastAiSectionData = dataKey;
  const loader = document.getElementById('coachAiLoading');
  if (loader) loader.style.display = 'flex';
  try {
    const resp = await fetch(appsScriptUrl, {
      method: 'POST', headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({ action: 'ai_suggest', sectionData, sectionName: activeLabel, allData: state })
    });
    const data = await resp.json();
    if (data.error === 'no_api_key' || data.error) { console.log('AI coach:', data.error); }
    else {
      const container = document.getElementById('coachSuggestions');
      let html = '';
      if (data.suggestions) data.suggestions.forEach(s => { html += `<div class="coach-card"><div class="coach-card-label ai">AI</div><p>${s}</p></div>`; });
      if (data.question) html += `<div class="coach-card"><div class="coach-card-label question">AI Question</div><p>${data.question}</p></div>`;
      if (html) container.innerHTML = html;
    }
  } catch(e) { console.log('AI coach error:', e.message); }
  if (loader) loader.style.display = 'none';
}

async function runResearch() {
  const input = document.getElementById('coachResearchInput');
  const query = input.value.trim();
  if (!query) return;
  if (!appsScriptUrl) { showToast('Apps Script not configured', 'warning'); return; }
  input.value = '';
  const loader = document.getElementById('coachAiLoading');
  if (loader) { loader.style.display = 'flex'; loader.innerHTML = '<div class="spinner"></div> Searching the web...'; }
  const btn = document.querySelector('.coach-research-row button');
  if (btn) { btn.disabled = true; btn.textContent = 'Searching...'; }
  collectState();
  const context = JSON.stringify(state, null, 2).substring(0, 2000);
  const industry = state.dc_industry ? state.dc_industry.split('\n')[0] : '';
  try {
    const resp = await fetch(appsScriptUrl, {
      method: 'POST', headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({ action: 'ai_research', query: query, context: context, industry: industry })
    });
    const data = await resp.json();
    const container = document.getElementById('coachSuggestions');
    const answer = (data.response || 'No response received.').replace(/</g,'&lt;').replace(/\n/g,'<br>');
    let sourcesHtml = '';
    if (data.sources && data.sources.length > 0) {
      sourcesHtml = '<div class="research-sources">';
      data.sources.slice(0, 4).forEach(s => {
        const domain = s.url ? new URL(s.url).hostname.replace('www.','') : '';
        sourcesHtml += '<a class="research-source" href="' + (s.url||'#') + '" target="_blank" rel="noopener">' + domain + '</a>';
      });
      sourcesHtml += '</div>';
    }
    const webBadge = data.webSearchUsed ? '<span class="research-web-badge">Web</span>' : '';
    container.innerHTML = `<div class="coach-card research-card"><div class="coach-card-label ai">Research ${webBadge}</div><p>${answer}</p>${sourcesHtml}</div>` + container.innerHTML;
    showToast(data.webSearchUsed ? 'Web research complete' : 'Research complete', 'success');
  } catch(e) { showToast('Research failed - check connection', 'error'); }
  if (loader) { loader.style.display = 'none'; loader.innerHTML = '<div class="spinner"></div> Analyzing your inputs...'; }
  if (btn) { btn.disabled = false; btn.textContent = 'Research'; }
}

// Quick research suggestions based on current section
function getResearchSuggestions() {
  const secs = document.querySelectorAll('.workshop-section');
  let activeSec = 's0';
  secs.forEach(s => { if (s.getBoundingClientRect().top <= 200) activeSec = s.id; });
  const suggestions = {
    's1': ['typical {industry} company size', '{industry} average deal size', '{industry} TAM market size'],
    's2': ['top pain points for {industry} founders', 'founder psychology buying triggers', 'B2B SaaS churn benchmarks'],
    'sRI': ['average CAC for {industry}', '{industry} sales cycle length', 'B2B pricing benchmarks {industry}'],
    's7': ['{industry} case study metrics', 'typical ROI for financial consulting', 'due diligence timeline benchmarks'],
    's9': ['guarantee examples B2B services', 'risk reversal strategies SaaS', 'Hormozi offer stack examples'],
    's10': ['competitor landscape {industry}', '{industry} market positioning', 'differentiation strategies B2B'],
    'sSP': ['B2B discovery call best questions', 'sales qualification frameworks', 'B2B follow-up cadence benchmarks'],
    'sER': ['B2B retention rate benchmarks', 'upsell strategies for services', 'NPS benchmarks {industry}']
  };
  const raw = suggestions[activeSec] || ['market size for {industry}', '{industry} growth rate', 'competitor analysis {industry}'];
  const industry = (state.dc_industry || 'your industry').split('\n')[0].trim();
  return raw.map(s => s.replace(/\{industry\}/g, industry));
}

function showResearchSuggestions() {
  const container = document.getElementById('researchSuggestions');
  if (!container) return;
  collectState();
  const suggestions = getResearchSuggestions();
  container.innerHTML = suggestions.map(s =>
    '<button class="research-chip" onclick="document.getElementById(\'coachResearchInput\').value=\'' + s.replace(/'/g,"\\'") + '\';runResearch();">' + s + '</button>'
  ).join('');
}

// ==================== GOOGLE DRIVE BACKUP (via Apps Script) ====================
let driveConnected = false;
let driveAutoBackupTimer = null;

function initDrive() {
  if (!appsScriptUrl) return;
  fetch(appsScriptUrl + '?action=ping')
    .then(r => r.json())
    .then(d => {
      if (d.ok) {
        driveConnected = true;
        const btn = document.getElementById('driveBtn');
        if (btn) { btn.classList.add('connected'); document.getElementById('driveLabel').textContent = 'Drive Ready'; }
        startDriveAutoBackup();
      }
    }).catch(() => {});
}

function handleDriveConnect() {
  if (!appsScriptUrl) { showToast('Set your Apps Script URL first', 'warning'); return; }
  if (driveConnected) { backupToDrive(); return; }
  showToast('Connecting to Drive...', 'info');
  fetch(appsScriptUrl + '?action=ping')
    .then(r => r.json())
    .then(d => {
      if (d.ok) {
        driveConnected = true;
        const btn = document.getElementById('driveBtn');
        if (btn) { btn.classList.add('connected'); document.getElementById('driveLabel').textContent = 'Drive Connected'; }
        showToast('Google Drive connected - auto-backup every 5 min', 'success');
        startDriveAutoBackup();
        backupToDrive();
      } else {
        showToast('Apps Script error: ' + JSON.stringify(d), 'error');
      }
    }).catch(e => { showToast('Could not reach Apps Script: ' + e.message, 'error'); });
}

function startDriveAutoBackup() {
  if (driveAutoBackupTimer) clearInterval(driveAutoBackupTimer);
  driveAutoBackupTimer = setInterval(backupToDrive, 300000);
}

async function backupToDrive() {
  if (!appsScriptUrl || !driveConnected) { downloadBackup(); return; }
  collectState();
  try {
    const resp = await fetch(appsScriptUrl, {
      method: 'POST', headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({ action: 'backup', clientName: state.clientName || 'untitled', workshopData: state })
    });
    const result = await resp.json();
    if (result.success) {
      showToast('Backed up to Google Drive', 'success');
      localStorage.setItem('vp_lastDriveBackup', new Date().toISOString());
    } else {
      showToast('Drive backup error: ' + (result.error || 'unknown'), 'warning');
    }
  } catch(e) { showToast('Drive backup failed - saved locally', 'warning'); }
}

async function restoreFromDrive() {
  if (!appsScriptUrl) { showToast('Set your Apps Script URL first', 'warning'); return; }
  const clientSlug = (state.clientName || 'untitled').toLowerCase().replace(/[^a-z0-9]+/g, '-');
  try {
    showToast('Restoring from Drive...', 'info');
    const resp = await fetch(appsScriptUrl + '?action=restore&client=' + encodeURIComponent(clientSlug));
    const data = await resp.json();
    if (data.error) { showToast('No Drive backup found for ' + (state.clientName||'this client'), 'warning'); return; }
    populateForm(data);
    saveToLS();
    showToast('Restored from Google Drive', 'success');
  } catch(e) { showToast('Could not restore from Drive', 'error'); }
}


// ==================== ACCORDION TOGGLE ====================
function toggleSectionCollapse(sec) {
  if (!sec) return;
  sec.classList.toggle('collapsed');
  // Save collapsed state
  const id = sec.id;
  try {
    const collapsed = JSON.parse(localStorage.getItem('vp_collapsed') || '{}');
    collapsed[id] = sec.classList.contains('collapsed');
    localStorage.setItem('vp_collapsed', JSON.stringify(collapsed));
  } catch(e) {}
}

function restoreCollapsedState() {
  try {
    const collapsed = JSON.parse(localStorage.getItem('vp_collapsed') || '{}');
    for (const [id, isCollapsed] of Object.entries(collapsed)) {
      if (isCollapsed) document.getElementById(id)?.classList.add('collapsed');
    }
  } catch(e) {}
}

function injectCollapseIndicators() {
  document.querySelectorAll('.section-banner').forEach(banner => {
    const sec = banner.closest('.workshop-section');
    if (!sec) return;
    // Add collapse indicator
    const ind = document.createElement('span');
    ind.className = 'collapse-indicator';
    ind.textContent = '\u25BC';
    banner.insertBefore(ind, banner.firstChild);
    // Add click handler (but not on copy button)
    banner.addEventListener('click', e => {
      if (e.target.closest('.copy-section-btn')) return;
      toggleSectionCollapse(sec);
    });
  });
}

function toggleAccordion(id) {
  document.getElementById(id).classList.toggle('open');
}

// ==================== NAVIGATION ====================
function goToSection(id) { document.getElementById(id)?.scrollIntoView({behavior:'smooth'}); document.getElementById('sidebar')?.classList.remove('mobile-open'); }
function updateActiveNav() {
  const secs=document.querySelectorAll('.workshop-section'); let active='s0';
  secs.forEach(s=>{ if(s.getBoundingClientRect().top<=120) active=s.id; });
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.toggle('active',n.dataset.nav===active));
}

// ==================== EXPORT ====================
function exportMarkdown() {
  collectState();
  let md=`# Value Proposition Workshop - ${state.clientName||'Untitled'}\nDate: ${state.workshopDate||'-'} | Facilitator: ${state.facilitator||'-'}\n\n`;
  const fields=[['Dream Client Profile',[['Geography','dc_geography'],['Industry','dc_industry'],['Size','dc_companySize'],['Stage','dc_fundingStage'],['Titles','dc_jobTitles'],['Personality','dc_personality'],['Tech','dc_techStack'],['Best Clients','dc_bestClients'],['Dream Clients','dc_dreamClients']]],['What Drives Them',[['Goals','wd_businessGoals'],['Dreams','wd_personalDreams'],['Problems','wd_problems'],['Fears','wd_fears'],['Suspicions','wd_suspicions'],['Enemies','wd_enemies'],['Trends','wd_trends']]],['Before / After',[['Before','ba_before'],['Steps','ba_steps'],['After','ba_after'],['Framework','ba_frameworkName'],['Named Steps','ba_frameworkSteps'],['Summary','ba_frameworkSummary']]],['Guarantee',[['Guarantee','g_guarantee'],['Mechanism','g_mechanism'],['Risk Reversal','g_riskReversal'],['Value Stack','g_valueStack'],['Dream Outcome','g_dreamOutcome']]],['Hero Story',[['Narrative','hs_narrative']]]];
  fields.forEach(([h,fs])=>{ md+=`## ${h}\n\n`; fs.forEach(([l,k])=>md+=`### ${l}\n${state[k]||'(empty)'}\n\n`); });
  if(state._lists?.caseStudies?.length) { md+='## Case Studies\n\n'; state._lists.caseStudies.forEach((c,i)=>{ if(c.name) md+=`${i+1}. **${c.name}** - ${c.after||'-'} (${c.metric||'-'})\n`; }); md+='\n'; }
  if(state._lists?.objections?.length) { md+='## Objections\n\n'; state._lists.objections.forEach(o=>{ if(o.objection) md+=`**${o.objection}**\n${o.response||'-'}\n\n`; }); }
  navigator.clipboard.writeText(md).then(()=>showToast('Exported to clipboard as Markdown')).catch(()=>{downloadFile(md,`vp-${(state.clientName||'export').toLowerCase()}.md`,'text/markdown');showToast('Downloaded as Markdown file');});
}
function downloadBackup() { collectState(); downloadFile(JSON.stringify(state,null,2),`vp-backup-${(state.clientName||'x').toLowerCase().replace(/[^a-z0-9]+/g,'-')}-${Date.now()}.json`,'application/json'); }
function downloadFile(c,f,t) { const b=new Blob([c],{type:t}); const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u;a.download=f;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u); }
function importBackup(file) { if(!file)return; const r=new FileReader(); r.onload=e=>{ try{const d=JSON.parse(e.target.result);if(!d.clientName){showToast('Invalid backup file','error');return;}populateForm(d);saveToLS();showToast('Imported: '+d.clientName);closeModal('loadModal');}catch(err){showToast('Parse error: '+err.message,'error');}}; r.readAsText(file); }

// ==================== MODALS ====================
function showNewWorkshop() { document.getElementById('newWorkshopModal').classList.add('open'); document.getElementById('newClientInput').focus(); }
function showLoadDialog() {
  const clients=getSavedClients(); const c=document.getElementById('savedClientsList');
  const entries=Object.entries(clients);
  c.innerHTML=entries.length===0?'<p style="color:var(--text-muted)">No saved workshops.</p>':entries.map(([k,info])=>`<button class="nav-footer-btn" style="text-align:left;margin-bottom:4px;padding:10px" onclick="loadClient('${k}')">${info.name} <span style="color:var(--text-muted);font-size:10px;margin-left:6px">${info.lastSaved?new Date(info.lastSaved).toLocaleDateString():''}</span></button>`).join('');
  document.getElementById('loadModal').classList.add('open');
}
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
function createNewWorkshop() {
  const name=document.getElementById('newClientInput').value.trim(); if(!name){showToast('Enter a client name','warning');return;}
  saveToLS();
  state={clientName:name,workshopDate:new Date().toISOString().split('T')[0],_lists:{caseStudies:[{name:'',before:'',after:'',metric:'',notes:''}],features:[{step:'',feature:'',benefit:'',proof:''}],competitors:[{name:'',positioning:'',advantage:'',loseWhen:''}],objections:[{objection:'',response:''}],faqs:[{question:'',answer:''}]}};
  for(const[id,items] of Object.entries(state._lists)) if(listDefs[id]) listDefs[id].items=[...items];
  document.querySelectorAll('[data-field]').forEach(el=>{if(el.type==='checkbox')el.checked=false;else if(el.type==='range'){el.value=5;const d=el.parentElement.querySelector('.slider-value');if(d)d.textContent='5';}else el.value='';});
  document.querySelector('[data-field="clientName"]').value=name;
  document.querySelector('[data-field="workshopDate"]').value=state.workshopDate;
  for(const id of Object.keys(listDefs)) renderDynamicList(id);
  saveToLS(); updateClientBadge(); updateProgress(); updateLiveSummary();
  closeModal('newWorkshopModal'); goToSection('s0');
}
function loadClient(key) { saveToLS(); const d=loadFromLS(key); if(d){populateForm(d);currentClientKey=key;localStorage.setItem('vp_last_client',key);} closeModal('loadModal'); }

// ==================== CMD+K SEARCH ====================
let searchSelectedIndex = -1;

function openSearch() {
  document.getElementById('searchOverlay').classList.add('open');
  const input = document.getElementById('searchInput');
  input.value = '';
  input.focus();
  searchSelectedIndex = -1;
  document.getElementById('searchResults').innerHTML = '<div class="search-empty">Type to search across all workshop fields</div>';
}

function closeSearch() {
  document.getElementById('searchOverlay').classList.remove('open');
}

function performSearch(query) {
  const container = document.getElementById('searchResults');
  searchSelectedIndex = -1;
  if (!query.trim()) {
    container.innerHTML = '<div class="search-empty">Type to search across all workshop fields</div>';
    return;
  }
  const q = query.toLowerCase();
  const results = [];
  document.querySelectorAll('.workshop-section').forEach(sec => {
    const secName = (sec.querySelector('.section-banner')?.textContent?.trim() || '').replace('AUTO-GENERATED', '').trim();
    sec.querySelectorAll('.field-group').forEach(fg => {
      const label = fg.querySelector('label')?.textContent?.trim() || '';
      const field = fg.querySelector('[data-field]');
      const value = field ? (field.type === 'checkbox' ? (field.checked ? 'Yes' : 'No') : field.value || '') : '';
      if (label.toLowerCase().includes(q) || value.toLowerCase().includes(q)) {
        results.push({ section: secName, label, value: value.substring(0, 120), sectionId: sec.id, fieldId: field?.dataset?.field || '' });
      }
    });
  });
  if (results.length === 0) { container.innerHTML = '<div class="search-empty">No matching fields found</div>'; return; }
  container.innerHTML = results.slice(0, 25).map((r, i) =>
    `<div class="search-result" data-idx="${i}" onclick="goToField('${r.sectionId}','${r.fieldId}')">
      <div class="search-result-section">${r.section}</div>
      <div class="search-result-label">${r.label}</div>
      ${r.value ? `<div class="search-result-value">${r.value.replace(/</g,'&lt;').replace(/\n/g,' ')}</div>` : ''}
    </div>`
  ).join('');
}

function goToField(sectionId, fieldId) {
  closeSearch();
  document.getElementById('sidebar')?.classList.remove('mobile-open');
  const sec = document.getElementById(sectionId);
  if (sec) sec.scrollIntoView({ behavior: 'smooth' });
  if (fieldId) {
    setTimeout(() => {
      const field = document.querySelector('[data-field="' + fieldId + '"]');
      if (field) { field.focus(); field.classList.add('search-highlight'); setTimeout(() => field.classList.remove('search-highlight'), 2000); }
    }, 500);
  }
}

// ==================== PDF EXPORT ====================
function exportPDF() {
  collectState();
  const s = state;
  const filled = (v) => v && v.trim();
  const esc = (v) => (v || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/\n/g,'<br>');

  let sections = '';

  // Business Snapshot
  const bsFields = [['Website','bs_website'],['Product/Service','bs_product'],['Annual Revenue','bs_annualRevenue'],['Employees','bs_employees'],['New Customers/Month','bs_newCustomersMonth'],['Avg Deal Size','bs_avgDealSize'],['Selling Mechanism','bs_sellingMechanism'],['Lead Source','bs_leadSource'],['Growth Constraint','bs_growthConstraint']];
  let bsHtml = '';
  bsFields.forEach(([l,k]) => { if (filled(s[k])) bsHtml += '<div class="pf"><label>' + l + '</label><p>' + esc(s[k]) + '</p></div>'; });
  if (bsHtml) sections += '<div class="ps"><h2>Business Snapshot</h2><div class="pg">' + bsHtml + '</div></div>';

  // ICP
  const icpFields = [['Geography','dc_geography'],['Industry','dc_industry'],['Company Size','dc_companySize'],['Funding Stage','dc_fundingStage'],['Decision Makers','dc_jobTitles'],['Buyer Traits','dc_personality'],['Revenue Range','dc_revenue'],['Growth Signals','dc_growthSignals'],['Team Structure','dc_teamStructure'],['Best Clients','dc_bestClients'],['Dream Clients','dc_dreamClients']];
  let icpHtml = '';
  icpFields.forEach(([l,k]) => { if (filled(s[k])) icpHtml += '<div class="pf"><label>' + l + '</label><p>' + esc(s[k]) + '</p></div>'; });
  if (icpHtml) sections += '<div class="ps"><h2>Ideal Client Profile</h2>' + icpHtml + '</div>';

  // Psychology
  const psyFields = [['Business Goals','wd_businessGoals'],['Personal Motivations','wd_personalDreams'],['Core Problems','wd_problems'],['Deepest Fears','wd_fears'],['Suspicions','wd_suspicions'],['Internal Enemies','wd_enemies'],['Market Trends','wd_trends'],['Identity Story','wd_identityStory'],['Status Signals','wd_statusSignals']];
  let psyHtml = '<div class="pf"><label>Pain Severity</label><p><strong>' + (s.wd_painSeverity || '?') + '/10</strong></p></div>';
  if (filled(s.wd_painCost)) psyHtml += '<div class="pf hl"><label>Cost of Pain</label><p>' + esc(s.wd_painCost) + '</p></div>';
  psyFields.forEach(([l,k]) => { if (filled(s[k])) psyHtml += '<div class="pf"><label>' + l + '</label><p>' + esc(s[k]) + '</p></div>'; });
  sections += '<div class="ps"><h2>Psychographic Profile</h2>' + psyHtml + '</div>';

  // Revenue Intelligence
  const riFields = [['Budget Range','ri_budget'],['Purchase Cycle','ri_purchaseCycle'],['Expected LTV','ri_lifetimeValue'],['ROI Expectations','ri_roiExpectation'],['Cost of Inaction','ri_costOfInaction']];
  let riHtml = '';
  riFields.forEach(([l,k]) => { if (filled(s[k])) riHtml += '<div class="pf"><label>' + l + '</label><p>' + esc(s[k]) + '</p></div>'; });
  if (riHtml) sections += '<div class="ps"><h2>Revenue Intelligence</h2>' + riHtml + '</div>';

  // Transformation
  let tfHtml = '';
  if (filled(s.ba_before)) tfHtml += '<div class="pf hl"><label>BEFORE</label><p>' + esc(s.ba_before) + '</p></div>';
  if (filled(s.ba_steps)) tfHtml += '<div class="pf"><label>Process Steps</label><p>' + esc(s.ba_steps) + '</p></div>';
  if (filled(s.ba_after)) tfHtml += '<div class="pf hl"><label>AFTER</label><p>' + esc(s.ba_after) + '</p></div>';
  if (filled(s.ba_frameworkName)) tfHtml += '<div class="pf"><label>Framework</label><p><strong>' + esc(s.ba_frameworkName) + '</strong></p></div>';
  if (filled(s.ba_frameworkSteps)) tfHtml += '<div class="pf"><label>Named Steps</label><p>' + esc(s.ba_frameworkSteps) + '</p></div>';
  if (filled(s.ba_timeline)) tfHtml += '<div class="pf"><label>Timeline</label><p>' + esc(s.ba_timeline) + '</p></div>';
  if (tfHtml) sections += '<div class="ps"><h2>Transformation Journey</h2>' + tfHtml + '</div>';

  // Guarantee
  let gHtml = '';
  if (filled(s.g_guarantee)) gHtml += '<div class="pf hl"><label>Guarantee</label><p>' + esc(s.g_guarantee) + '</p></div>';
  if (filled(s.g_mechanism)) gHtml += '<div class="pf"><label>Unique Mechanism</label><p>' + esc(s.g_mechanism) + '</p></div>';
  if (filled(s.g_dreamOutcome)) gHtml += '<div class="pf hl"><label>Dream Outcome</label><p>' + esc(s.g_dreamOutcome) + '</p></div>';
  if (filled(s.g_valueStack)) gHtml += '<div class="pf"><label>Value Stack</label><p>' + esc(s.g_valueStack) + '</p></div>';
  if (filled(s.g_riskReversal)) gHtml += '<div class="pf"><label>Risk Reversal</label><p>' + esc(s.g_riskReversal) + '</p></div>';
  if (gHtml) sections += '<div class="ps"><h2>Guarantee &amp; Offer</h2>' + gHtml + '</div>';

  // Sales Process
  const spFields = [['Qualification Criteria','sp_qualificationCriteria'],['Discovery Questions','sp_discoveryQuestions'],['Demo Strategy','sp_demoStrategy'],['Closing Strategies','sp_closingTechniques'],['Follow-Up Cadence','sp_followUpCadence']];
  let spHtml = '';
  spFields.forEach(([l,k]) => { if (filled(s[k])) spHtml += '<div class="pf"><label>' + l + '</label><p>' + esc(s[k]) + '</p></div>'; });
  if (spHtml) sections += '<div class="ps"><h2>Sales Process</h2>' + spHtml + '</div>';

  // Case Studies
  if (s._lists?.caseStudies?.some(c => c.name)) {
    let csHtml = '';
    s._lists.caseStudies.forEach(c => {
      if (c.name) csHtml += '<div class="pf"><label>' + esc(c.name) + '</label><p>' + (c.metric ? '<strong>' + esc(c.metric) + '</strong><br>' : '') + esc(c.after || c.before || c.notes || '') + '</p></div>';
    });
    sections += '<div class="ps"><h2>Case Studies</h2>' + csHtml + '</div>';
  }

  // Competitive
  if (filled(s.cp_differentiator) || s._lists?.competitors?.some(c => c.name)) {
    let cpHtml = '';
    if (filled(s.cp_differentiator)) cpHtml += '<div class="pf hl"><label>#1 Differentiator</label><p>' + esc(s.cp_differentiator) + '</p></div>';
    if (s._lists?.competitors) s._lists.competitors.forEach(c => {
      if (c.name) cpHtml += '<div class="pf"><label>vs. ' + esc(c.name) + '</label><p>' + esc(c.advantage || c.positioning || '') + '</p></div>';
    });
    sections += '<div class="ps"><h2>Competitive Position</h2>' + cpHtml + '</div>';
  }

  // Objections
  if (s._lists?.objections?.some(o => o.objection)) {
    let obHtml = '';
    s._lists.objections.forEach(o => {
      if (o.objection) obHtml += '<div class="pf"><label>"' + esc(o.objection) + '"</label><p>' + esc(o.response || 'Response pending') + '</p></div>';
    });
    sections += '<div class="ps"><h2>Common Objections</h2>' + obHtml + '</div>';
  }

  // Hero Story
  if (filled(s.hs_narrative)) sections += '<div class="ps"><h2>Founder Story</h2><div class="pf"><p>' + esc(s.hs_narrative) + '</p></div></div>';

  // Auto-generated one-liner
  let oneliner = '';
  if (filled(s.dc_industry) && filled(s.wd_problems)) {
    const who = (s.dc_industry || '').split('\\n')[0].substring(0, 50);
    const pain = (s.wd_problems || '').split('\\n')[0].substring(0, 60);
    const outcome = (s.g_dreamOutcome || s.ba_after || '').split('\\n')[0].substring(0, 60);
    oneliner = 'We help ' + who + ' who struggle with ' + pain.toLowerCase() + (outcome ? ' to ' + outcome.toLowerCase() : '') + '.';
  }

  const dateStr = s.workshopDate ? new Date(s.workshopDate + 'T12:00:00').toLocaleDateString('en-US', {year:'numeric',month:'long',day:'numeric'}) : '';

  const html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Value Proposition Report - ' + (s.clientName || 'Client') + '</title>' +
    '<style>@import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap");' +
    '*{margin:0;padding:0;box-sizing:border-box}' +
    'body{font-family:"Inter",system-ui,sans-serif;color:#1a1a30;line-height:1.7;padding:48px;max-width:820px;margin:0 auto}' +
    '.cover{text-align:center;padding:60px 0 40px;margin-bottom:40px;border-bottom:3px solid #7c3aed}' +
    '.cover h1{font-size:32px;font-weight:800;color:#7c3aed;margin-bottom:6px;letter-spacing:-0.5px}' +
    '.cover .sub{font-size:20px;font-weight:500;color:#55556e;margin-bottom:24px}' +
    '.cover .meta{font-size:13px;color:#8888a0}.cover .meta span{margin:0 12px}' +
    '.ol{background:#f5f0ff;border-left:4px solid #7c3aed;padding:16px 20px;margin-bottom:36px;border-radius:0 8px 8px 0;font-size:15px;line-height:1.7}' +
    '.ps{margin-bottom:36px;page-break-inside:avoid}' +
    '.ps h2{font-size:14px;font-weight:700;color:#7c3aed;text-transform:uppercase;letter-spacing:2.5px;padding-bottom:8px;border-bottom:2px solid #e8e0f8;margin-bottom:16px}' +
    '.pf{margin-bottom:14px}.pf label{display:block;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:#8888a0;margin-bottom:3px}' +
    '.pf p{font-size:13.5px;color:#1a1a30;line-height:1.7}' +
    '.pf.hl{background:#f8f7ff;padding:14px 18px;border-radius:8px;border:1px solid #e8e0f8}' +
    '.pg{display:grid;grid-template-columns:1fr 1fr;gap:12px 24px}' +
    '.ft{text-align:center;margin-top:60px;padding-top:20px;border-top:1px solid #e0e0ee;font-size:11px;color:#8888a0}' +
    '.ft strong{color:#7c3aed}' +
    '@media print{body{padding:24px}.cover{padding:40px 0 30px}}' +
    '</style></head><body>' +
    '<div class="cover"><h1>Value Proposition Report</h1>' +
    '<div class="sub">' + esc(s.clientName || 'Client') + '</div>' +
    '<div class="meta">' + dateStr + '<span>|</span>Facilitator: ' + esc(s.facilitator || 'N/A') + '</div></div>' +
    (oneliner ? '<div class="ol">' + oneliner + '</div>' : '') +
    sections +
    '<div class="ft">Generated by <strong>Dopamine Digital</strong> Value Proposition Workshop</div>' +
    '</body></html>';

  const win = window.open('', '_blank');
  if (win) { win.document.write(html); win.document.close(); setTimeout(() => win.print(), 600); }
  showToast('PDF report generated', 'success');
}

// ==================== INIT ====================
document.addEventListener('keydown',e=>{
  if((e.metaKey||e.ctrlKey)&&e.key==='s'){e.preventDefault();collectState();saveToLS();}
  if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();openSearch();}
  if(e.key==='Escape'){
    closeSearch();
    document.getElementById('exportWrap')?.classList.remove('open');
    document.getElementById('helpOverlay')?.classList.remove('open');
  }
  if(e.key==='?' && !e.target.matches('input,textarea,select,[contenteditable]')){
    e.preventDefault();
    document.getElementById('helpOverlay')?.classList.toggle('open');
  }
  // Arrow keys in search
  if(document.getElementById('searchOverlay').classList.contains('open')){
    const results=document.querySelectorAll('.search-result');
    if(e.key==='ArrowDown'){e.preventDefault();searchSelectedIndex=Math.min(searchSelectedIndex+1,results.length-1);results.forEach((r,i)=>r.classList.toggle('selected',i===searchSelectedIndex));if(searchSelectedIndex>=0)results[searchSelectedIndex]?.scrollIntoView({block:'nearest'});}
    else if(e.key==='ArrowUp'){e.preventDefault();searchSelectedIndex=Math.max(searchSelectedIndex-1,-1);results.forEach((r,i)=>r.classList.toggle('selected',i===searchSelectedIndex));}
    else if(e.key==='Enter'&&searchSelectedIndex>=0){e.preventDefault();results[searchSelectedIndex]?.click();}
  }
});

function init() {
  const lastKey=localStorage.getItem('vp_last_client');
  let data=lastKey?loadFromLS(lastKey):null;
  if(data) {
    if(data._lists) for(const[id,items] of Object.entries(data._lists)) if(listDefs[id]) listDefs[id].items=items.map(i=>({...i}));
    for(const id of Object.keys(listDefs)) renderDynamicList(id);
    populateForm(data); currentClientKey=lastKey;
  } else {
    if(PHELLOS_DEFAULTS._lists) for(const[id,items] of Object.entries(PHELLOS_DEFAULTS._lists)) if(listDefs[id]) listDefs[id].items=items.map(i=>({...i}));
    for(const id of Object.keys(listDefs)) renderDynamicList(id);
    populateForm(PHELLOS_DEFAULTS); saveToLS();
  }
  document.addEventListener('input',e=>{if(e.target.matches('[data-field]')){if(e.target.tagName==='TEXTAREA')autoResize(e.target);if(e.target.dataset.field==='clientName')updateClientBadge();debouncedSave();}});
  document.addEventListener('change',e=>{if(e.target.matches('[data-field]')&&e.target.type==='checkbox')debouncedSave();});
  window.addEventListener('scroll',updateActiveNav,{passive:true}); updateActiveNav();
  document.querySelectorAll('textarea').forEach(autoResize);
  setInterval(()=>{const d=collectState();saveToIDB(getStorageKey(d.clientName),d);},SNAPSHOT_INTERVAL);
  setInterval(()=>{document.getElementById('backupReminder').style.display='block';},BACKUP_REMINDER_INTERVAL);
  window.addEventListener('beforeunload',()=>{collectState();saveToLS();});
  if(navigator.storage&&navigator.storage.persist) navigator.storage.persist();
  document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open');}));
  document.addEventListener('click',e=>{const ew=document.getElementById('exportWrap');if(ew&&!ew.contains(e.target))ew.classList.remove('open');});
  updateProgress(); updateLiveSummary(); updateMessagingMatrix();
  injectCopyButtons();
  injectCollapseIndicators();
  restoreCollapsedState();
  setInterval(updateTimer, 1000);
  // Init Google Drive connection via Apps Script
  setTimeout(initDrive, 1000);
  // Update coach on input with debounce (rule-based = 1s, AI = 3s)
  let coachTimeout = null;
  document.addEventListener('focusout', e => {
    if (e.target.matches('[data-field]')) {
      clearTimeout(coachTimeout); clearTimeout(aiSuggestTimeout);
      coachTimeout = setTimeout(updateCoachSuggestions, 1000);
      aiSuggestTimeout = setTimeout(requestAISuggestions, 3000);
    }
  });
}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
